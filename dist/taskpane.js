/*! For license information please see taskpane.js.LICENSE.txt */
!function(){var e={12610:function(){function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return n(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var o=0,s=function(){};return{s:s,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){l=!0,a=e},f:function(){try{i||null==r.return||r.return()}finally{if(l)throw a}}}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function r(){var e,t,n="function"==typeof Symbol?Symbol:{},s=n.iterator||"@@iterator",a=n.toStringTag||"@@toStringTag";function i(n,r,s,a){var i=r&&r.prototype instanceof c?r:c,u=Object.create(i.prototype);return o(u,"_invoke",function(n,r,o){var s,a,i,c=0,u=o||[],h=!1,d={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return s=t,a=0,i=e,d.n=n,l}};function p(n,r){for(a=n,i=r,t=0;!h&&c&&!o&&t<u.length;t++){var o,s=u[t],p=d.p,f=s[2];n>3?(o=f===r)&&(i=s[(a=s[4])?5:(a=3,3)],s[4]=s[5]=e):s[0]<=p&&((o=n<2&&p<s[1])?(a=0,d.v=r,d.n=s[1]):p<f&&(o=n<3||s[0]>r||r>f)&&(s[4]=n,s[5]=r,d.n=f,a=0))}if(o||n>1)return l;throw h=!0,r}return function(o,u,f){if(c>1)throw TypeError("Generator is already running");for(h&&1===u&&p(u,f),a=u,i=f;(t=a<2?e:i)||!h;){s||(a?a<3?(a>1&&(d.n=-1),p(a,i)):d.n=i:d.v=i);try{if(c=2,s){if(a||(o="next"),t=s[o]){if(!(t=t.call(s,i)))throw TypeError("iterator result is not an object");if(!t.done)return t;i=t.value,a<2&&(a=0)}else 1===a&&(t=s.return)&&t.call(s),a<2&&(i=TypeError("The iterator does not provide a '"+o+"' method"),a=1);s=e}else if((t=(h=d.n<0)?i:n.call(r,d))!==l)break}catch(t){s=e,a=1,i=t}finally{c=1}}return{value:t,done:h}}}(n,s,a),!0),u}var l={};function c(){}function u(){}function h(){}t=Object.getPrototypeOf;var d=[][s]?t(t([][s]())):(o(t={},s,function(){return this}),t),p=h.prototype=c.prototype=Object.create(d);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,o(e,a,"GeneratorFunction")),e.prototype=Object.create(p),e}return u.prototype=h,o(p,"constructor",h),o(h,"constructor",u),u.displayName="GeneratorFunction",o(h,a,"GeneratorFunction"),o(p),o(p,a,"Generator"),o(p,s,function(){return this}),o(p,"toString",function(){return"[object Generator]"}),(r=function(){return{w:i,m:f}})()}function o(e,t,n,r){var s=Object.defineProperty;try{s({},"",{})}catch(e){s=0}o=function(e,t,n,r){function a(t,n){o(e,t,function(e){return this._invoke(t,n,e)})}t?s?s(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},o(e,t,n,r)}function s(e,t,n,r,o,s,a){try{var i=e[s](a),l=i.value}catch(e){return void n(e)}i.done?t(l):Promise.resolve(l).then(r,o)}function a(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){s(a,r,o,i,l,"next",e)}function l(e){s(a,r,o,i,l,"throw",e)}i(void 0)})}}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,l(r.key),r)}}function l(t){var n=function(t){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(n)?n:n+""}var c=function(){return n=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.CONFIG={MAX_ANALYSIS_CELLS:1e5,CHUNK_SIZE:1e4,SAMPLE_RATIO:.1},this.currentWorksheetData=null,this.workbookStructure=null},o=[{key:"readCurrentWorksheetDataEnhanced",value:(h=a(r().m(function e(){var t,n,o=this,s=arguments;return r().w(function(e){for(;;)if(0===e.n)return t=!(s.length>0&&void 0!==s[0])||s[0],n=s.length>1&&void 0!==s[1]&&s[1],e.a(2,new Promise(function(e,s){Excel.run(function(){var i=a(r().m(function a(i){var l,c,u,h,d,p,f,g,m,y,b,k,v,w,x,E,C,S,T,_,I,A,R;return r().w(function(r){for(;;)switch(r.p=r.n){case 0:if(r.p=0,(l=i.workbook.worksheets.getActiveWorksheet()).load("name"),u=!1,h=!1,d={},p=l.tables,f=l.pivotTables,g=l.charts,p.load(["name","id"]),f.load(["name","id"]),g.load(["name","id"]),!t){r.n=4;break}return(m=i.workbook.getSelectedRange()).load(["values","formulas","rowCount","columnCount","address","numberFormat"]),r.n=1,i.sync();case 1:if(!(m.rowCount>1||m.columnCount>1||null!==m.values[0][0]&&""!==m.values[0][0])){r.n=4;break}if(!((y=m.rowCount*m.columnCount)<=o.CONFIG.MAX_ANALYSIS_CELLS)){r.n=2;break}c=m,u=!0,console.log("Using selection: ".concat(c.address," (").concat(y," cells)")),r.n=4;break;case 2:return console.log("Selection too large (".concat(y," cells), using smart sampling instead")),r.n=3,o.getSmartSampledRange(i,l,m);case 3:c=r.v,u=!0,h=!0;case 4:if(c){r.n=8;break}if(!(b=l.getUsedRange())){r.n=8;break}return b.load(["values","formulas","rowCount","columnCount","address","numberFormat"]),r.n=5,i.sync();case 5:if(k=b.rowCount*b.columnCount,console.log("Detected used range: ".concat(b.address," (").concat(k," cells)")),!(k<=o.CONFIG.MAX_ANALYSIS_CELLS)){r.n=6;break}c=b,r.n=8;break;case 6:return console.log("Used range too large (".concat(k," cells), applying smart sampling")),r.n=7,o.getSmartSampledRange(i,l,b);case 7:c=r.v,h=!0;case 8:return r.n=9,i.sync();case 9:return T=p.items.map(function(e){return{name:e.name,id:e.id}}),_=f.items.map(function(e){return{name:e.name,id:e.id}}),I=g.items.map(function(e){return{name:e.name,id:e.id}}),r.n=10,o.detectNamedRanges(i);case 10:if(A=r.v,d={tables:T,pivotTables:_,charts:I,hasNamedRanges:A},c&&0!==c.rowCount&&0!==c.columnCount){r.n=11;break}return o.currentWorksheetData={worksheetName:l.name,structuredData:{type:"empty",headers:[],dataRows:[],keyRows:[]},dataMetadata:d,summary:"The current worksheet appears to be empty."},e(o.currentWorksheetData),r.a(2);case 11:if(v=c.values,w=c.formulas,x=c.numberFormat,E=c.address,console.log("Processing range: ".concat(E," (").concat(c.rowCount," rows × ").concat(c.columnCount," columns)")),C=o.analyzeAdvancedTableStructure(v,w,x),S=null,!n){r.n=13;break}return r.n=12,o.analyzeWorkbookStructure(i);case 12:S=r.v;case 13:o.currentWorksheetData={worksheetName:l.name,address:E,totalRows:c.rowCount,totalCols:c.columnCount,rawData:v,rawFormulas:w,numberFormats:x,structuredData:C,dataMetadata:d,workbookData:S,isSelection:u,isSampled:h,summary:o.generateDataSummary(l.name,E,c,u,h,C,d)},e(o.currentWorksheetData),r.n=15;break;case 14:r.p=14,R=r.v,s(new Error("Failed to read Excel data: "+R.message));case 15:return r.a(2)}},a,null,[[0,14]])}));return function(e){return i.apply(this,arguments)}}())}))},e)})),function(){return h.apply(this,arguments)})},{key:"getSmartSampledRange",value:(u=a(r().m(function e(t,n,o){var s,a,i,l,c,u,h,d,p,f,g,m,y,b,k,v,w,x,E,C,S;return r().w(function(e){for(;;)switch(e.n){case 0:if(s=o.rowCount,a=o.columnCount,i=Math.min(Math.floor(Math.sqrt(this.CONFIG.MAX_ANALYSIS_CELLS)),s),l=Math.min(Math.floor(this.CONFIG.MAX_ANALYSIS_CELLS/i),a),c=Math.min(5,s),u=Math.min(3,s-c),h=Math.max(0,i-c-u),d=Math.min(l,a),console.log("Smart sampling: ".concat(i," rows × ").concat(d," cols from ").concat(s," × ").concat(a)),p=[],c>0&&(f=this.getColumnLetter(1),g=this.getColumnLetter(d),p.push("".concat(f,"1:").concat(g).concat(c))),h>0)for(m=Math.floor((s-c-u)/h),y=0;y<h;y++)b=c+1+y*m,k=this.getColumnLetter(1),v=this.getColumnLetter(d),p.push("".concat(k).concat(b,":").concat(v).concat(b));return u>0&&(w=s-u+1,x=this.getColumnLetter(1),E=this.getColumnLetter(d),p.push("".concat(x).concat(w,":").concat(E).concat(s))),C=this.getColumnLetter(d),(S=n.getRange("A1:".concat(C).concat(i))).load(["values","formulas","rowCount","columnCount","address","numberFormat"]),e.n=1,t.sync();case 1:return S._isSampled=!0,S._originalSize={rows:s,cols:a},e.a(2,S)}},e,this)})),function(e,t,n){return u.apply(this,arguments)})},{key:"detectNamedRanges",value:(c=a(r().m(function e(t){var n,o;return r().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,(n=t.workbook.names).load(["name","type"]),e.n=1,t.sync();case 1:return e.a(2,n.items.length>0);case 2:return e.p=2,o=e.v,console.log("Could not detect named ranges:",o),e.a(2,!1)}},e,null,[[0,2]])})),function(e){return c.apply(this,arguments)})},{key:"analyzeWorkbookStructure",value:(l=a(r().m(function e(n){var o,s,a,i,l,c,u,h;return r().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,(o=n.workbook.worksheets).load(["name","position"]),e.n=1,n.sync();case 1:s=[],a=t(o.items),e.p=2,a.s();case 3:if((i=a.n()).done){e.n=7;break}if(l=i.value,!(c=l.getUsedRange())){e.n=5;break}return c.load(["rowCount","columnCount","address"]),e.n=4,n.sync();case 4:s.push({name:l.name,position:l.position,dataRange:c.address,rowCount:c.rowCount,columnCount:c.columnCount,totalCells:c.rowCount*c.columnCount}),e.n=6;break;case 5:s.push({name:l.name,position:l.position,dataRange:"Empty",rowCount:0,columnCount:0,totalCells:0});case 6:e.n=3;break;case 7:e.n=9;break;case 8:e.p=8,u=e.v,a.e(u);case 9:return e.p=9,a.f(),e.f(9);case 10:return e.a(2,{totalSheets:o.items.length,sheets:s,totalDataCells:s.reduce(function(e,t){return e+t.totalCells},0)});case 11:return e.p=11,h=e.v,console.log("Could not analyze workbook structure:",h),e.a(2,null)}},e,null,[[2,8,9,10],[0,11]])})),function(e){return l.apply(this,arguments)})},{key:"analyzeAdvancedTableStructure",value:function(t,n,r){var o=this;if(!t||0===t.length)return{type:"empty",headers:[],dataRows:[],keyRows:[]};var s={type:"advanced_financial_table",headers:[],columnHeaders:[],dataRows:[],keyRows:[],totalRows:[],quarterlyData:[],rowLabels:[],formulaAnalysis:this.analyzeFormulas(n),formatAnalysis:this.analyzeNumberFormats(r),dataTypes:this.analyzeDataTypes(t,r)},a=t.map(function(t,s){return t.map(function(t,a){if(null==t)return"";if("string"==typeof t)return t.trim();var i=r&&r[s]&&r[s][a];return{value:t,originalType:e(t),format:i,isFormula:n&&n[s]&&n[s][a]&&"string"==typeof n[s][a]&&n[s][a].startsWith("="),detectedType:o.detectCellType(t,i)}})}),i=this.findHeaderRow(a);console.log("Header detection: Found header at row ".concat(i)),console.log("Sample data preview:",a.slice(0,3).map(function(t,n){return"Row ".concat(n,": [").concat(t.slice(0,5).map(function(t){return"object"===e(t)?t.value:t}).join(", "),"]")})),-1!==i&&(s.columnHeaders=a[i].map(function(t){return"object"===e(t)?t.value:t})),console.log("Processing ALL data rows starting from row 0 (including header)");for(var l=0;l<a.length;l++){var c=a[l],u="object"===e(c[0])?c[0].value:c[0];if(u&&""!==u){var h={rowIndex:l,label:u,values:c.slice(1).map(function(t){return"object"===e(t)?t.value:t}),originalRow:c,isTotal:this.isLikelyTotalRow(u),isSubtotal:this.isLikelySubtotalRow(u),category:this.categorizeRowLabel(u),hasFormulas:c.some(function(t){return"object"===e(t)&&t.isFormula}),dataTypes:c.map(function(t){return"object"===e(t)?t.detectedType:"text"})};if(s.dataRows.push(h),s.rowLabels.push(u),(h.isTotal||this.isKeyFinancialRow(u))&&s.keyRows.push(h),h.isTotal&&s.totalRows.push(h),this.hasQuarterlyPattern(s.columnHeaders)){var d=this.extractQuarterlyData(h,s.columnHeaders);d.quarters.length>0&&s.quarterlyData.push(d)}}}return s}},{key:"analyzeFormulas",value:function(e){if(!e)return{hasFormulas:!1,formulaCount:0,types:[]};var t=0,n=new Set;return e.forEach(function(e){e.forEach(function(e){if("string"==typeof e&&e.startsWith("=")){t++;var r=e.match(/([A-Z]+)\(/g);r&&r.forEach(function(e){n.add(e.slice(0,-1))})}})}),{hasFormulas:t>0,formulaCount:t,types:Array.from(n)}}},{key:"analyzeNumberFormats",value:function(e){if(!e)return{hasFormatting:!1,types:[]};var t=new Set;return e.forEach(function(e){e.forEach(function(e){e&&"General"!==e&&t.add(e)})}),{hasFormatting:t.size>0,types:Array.from(t)}}},{key:"analyzeDataTypes",value:function(e,t){var n=this,r={text:0,number:0,date:0,currency:0,percentage:0,boolean:0};return e.forEach(function(e,o){e.forEach(function(e,s){var a=t&&t[o]&&t[o][s],i=n.detectCellType(e,a);r.hasOwnProperty(i)&&r[i]++})}),r}},{key:"detectCellType",value:function(e,t){if(null==e||""===e)return"empty";if("boolean"==typeof e)return"boolean";if("number"==typeof e){if(t){if(t.includes("$")||t.includes("currency"))return"currency";if(t.includes("%"))return"percentage";if(t.includes("d")||t.includes("m")||t.includes("y"))return"date"}return"number"}if("string"==typeof e){if(!isNaN(Date.parse(e)))return"date";if(!isNaN(parseFloat(e))&&isFinite(e))return"number"}return"text"}},{key:"findHeaderRow",value:function(t){for(var n=0;n<Math.min(5,t.length);n++){var r=t[n];if(r.filter(function(t){var n="object"===e(t)?t.value:t;return"string"==typeof n&&/^[1-4]Q\d{2}$/i.test(n)}).length>=2)return n;if(r.filter(function(t){var n="object"===e(t)?t.value:t;return"string"==typeof n&&n.length>0&&isNaN(n)}).length>=3)return n}return 0}},{key:"isKeyFinancialRow",value:function(e){return"string"==typeof e&&[/revenue|sales|income/i,/expense|cost|opex|capex/i,/profit|loss|ebitda|ebit/i,/cash|flow|fcf/i,/margin|ratio/i,/growth|change/i].some(function(t){return t.test(e)})}},{key:"hasQuarterlyPattern",value:function(e){return e.some(function(e){return/^[1-4]Q\d{2}$/i.test(String(e))})}},{key:"generateDataSummary",value:function(e,t,n,r,o,s,a){var i="".concat(r?"Selected range":"Worksheet",' "').concat(r?t:e,'" ');if(i+="contains ".concat(n.rowCount," rows and ").concat(n.columnCount," columns"),o){var l=n._originalSize;i+=l?" (sampled from ".concat(l.rows," × ").concat(l.cols,")"):" (intelligently sampled)"}return s.keyRows&&s.keyRows.length>0&&(i+=". Found ".concat(s.keyRows.length," key financial rows")),s.quarterlyData&&s.quarterlyData.length>0&&(i+=", ".concat(s.quarterlyData.length," quarterly data series")),a.tables&&a.tables.length>0&&(i+=", ".concat(a.tables.length," Excel tables")),a.pivotTables&&a.pivotTables.length>0&&(i+=", ".concat(a.pivotTables.length," pivot tables")),a.charts&&a.charts.length>0&&(i+=", ".concat(a.charts.length," charts")),i+"."}},{key:"isLikelyTotalRow",value:function(e){return"string"==typeof e&&/^(total|sum|grand total|net|aggregate|consolidated)/i.test(e.trim())}},{key:"isLikelySubtotalRow",value:function(e){return"string"==typeof e&&/subtotal|sub-total|sub total/i.test(e.trim())}},{key:"categorizeRowLabel",value:function(e){return"string"!=typeof e?"data":e.trim()}},{key:"extractQuarterlyData",value:function(e,t){var n=[];return t.forEach(function(t,r){if("string"==typeof t&&/^[1-4]Q\d{2}$/i.test(t)){var o=e.values[r-1];null!=o&&""!==o&&n.push({quarter:t,value:parseFloat(o)||o,columnIndex:r})}}),{label:e.label,labelType:e.category,quarters:n,isTotal:e.isTotal}}},{key:"getColumnLetter",value:function(e){for(var t="";e>0;){var n=(e-1)%26;t=String.fromCharCode(65+n)+t,e=Math.floor((e-1)/26)}return t}},{key:"getColumnNumber",value:function(e){for(var t=0,n=0;n<e.length;n++)t=26*t+(e.charCodeAt(n)-64);return t}},{key:"readAllWorksheets",value:(s=a(r().m(function e(){var n=this;return r().w(function(e){for(;;)if(0===e.n)return e.a(2,new Promise(function(e,o){Excel.run(function(){var s=a(r().m(function s(a){var i,l,c,u,h,d,p,f,g,m;return r().w(function(r){for(;;)switch(r.p=r.n){case 0:return r.p=0,r.n=1,n.analyzeWorkbookStructure(a);case 1:return i=r.v,l=[],(c=a.workbook.worksheets).load(["name"]),r.n=2,a.sync();case 2:u=t(c.items),r.p=3,u.s();case 4:if((h=u.n()).done){r.n=10;break}return d=h.value,r.p=5,a.workbook.worksheets.getItem(d.name).activate(),r.n=6,a.sync();case 6:return r.n=7,n.readCurrentWorksheetDataEnhanced(!1,!1);case 7:p=r.v,l.push(p),r.n=9;break;case 8:r.p=8,f=r.v,console.log("Error reading sheet ".concat(d.name,":"),f),l.push({worksheetName:d.name,error:f.message,structuredData:{type:"error"}});case 9:r.n=4;break;case 10:r.n=12;break;case 11:r.p=11,g=r.v,u.e(g);case 12:return r.p=12,u.f(),r.f(12);case 13:e({workbookData:i,allSheets:l,summary:"Read ".concat(l.length," worksheets from workbook")}),r.n=15;break;case 14:r.p=14,m=r.v,o(new Error("Failed to read all worksheets: "+m.message));case 15:return r.a(2)}},s,null,[[5,8],[3,11,12,13],[0,14]])}));return function(e){return s.apply(this,arguments)}}())}))},e)})),function(){return s.apply(this,arguments)})},{key:"getCurrentWorksheetData",value:function(){return this.currentWorksheetData}},{key:"clearCurrentData",value:function(){this.currentWorksheetData=null,this.workbookStructure=null}}],o&&i(n.prototype,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,o,s,l,c,u,h}();"undefined"!=typeof window&&(window.DataService=c)},58394:function(e,t,n){"use strict";e.exports=n.p+"3787a8bd727ae2d32c46.css"},60947:function(e,t,n){"use strict";e.exports=n.p+"60cb60db06076b674850.js"},98362:function(e,t,n){"use strict";e.exports=n.p+"assets/logo-filled.png"}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var s=t[r]={exports:{}};return e[r](s,s.exports,n),s.exports}n.m=e,n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");if(r.length)for(var o=r.length-1;o>-1&&(!e||!/^http(s?):/.test(e));)e=r[o--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e}(),n.b=document.baseURI||self.location.href,function(){"use strict";var e,t,r;n(12610),function(e){e.STRING="string",e.NUMBER="number",e.INTEGER="integer",e.BOOLEAN="boolean",e.ARRAY="array",e.OBJECT="object"}(e||(e={})),function(e){e.LANGUAGE_UNSPECIFIED="language_unspecified",e.PYTHON="python"}(t||(t={})),function(e){e.OUTCOME_UNSPECIFIED="outcome_unspecified",e.OUTCOME_OK="outcome_ok",e.OUTCOME_FAILED="outcome_failed",e.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"}(r||(r={}));const o=["user","model","function","system"];var s,a,i,l,c,u,h,d,p;!function(e){e.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",e.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",e.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",e.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",e.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",e.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"}(s||(s={})),function(e){e.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",e.BLOCK_NONE="BLOCK_NONE"}(a||(a={})),function(e){e.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",e.NEGLIGIBLE="NEGLIGIBLE",e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH"}(i||(i={})),function(e){e.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",e.SAFETY="SAFETY",e.OTHER="OTHER"}(l||(l={})),function(e){e.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",e.STOP="STOP",e.MAX_TOKENS="MAX_TOKENS",e.SAFETY="SAFETY",e.RECITATION="RECITATION",e.LANGUAGE="LANGUAGE",e.BLOCKLIST="BLOCKLIST",e.PROHIBITED_CONTENT="PROHIBITED_CONTENT",e.SPII="SPII",e.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",e.OTHER="OTHER"}(c||(c={})),function(e){e.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",e.RETRIEVAL_QUERY="RETRIEVAL_QUERY",e.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",e.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",e.CLASSIFICATION="CLASSIFICATION",e.CLUSTERING="CLUSTERING"}(u||(u={})),function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.AUTO="AUTO",e.ANY="ANY",e.NONE="NONE"}(h||(h={})),function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.MODE_DYNAMIC="MODE_DYNAMIC"}(d||(d={}));class f extends Error{constructor(e){super(`[GoogleGenerativeAI Error]: ${e}`)}}class g extends f{constructor(e,t){super(e),this.response=t}}class m extends f{constructor(e,t,n,r){super(e),this.status=t,this.statusText=n,this.errorDetails=r}}class y extends f{}class b extends f{}!function(e){e.GENERATE_CONTENT="generateContent",e.STREAM_GENERATE_CONTENT="streamGenerateContent",e.COUNT_TOKENS="countTokens",e.EMBED_CONTENT="embedContent",e.BATCH_EMBED_CONTENTS="batchEmbedContents"}(p||(p={}));class k{constructor(e,t,n,r,o){this.model=e,this.task=t,this.apiKey=n,this.stream=r,this.requestOptions=o}toString(){var e,t;const n=(null===(e=this.requestOptions)||void 0===e?void 0:e.apiVersion)||"v1beta";let r=`${(null===(t=this.requestOptions)||void 0===t?void 0:t.baseUrl)||"https://generativelanguage.googleapis.com"}/${n}/${this.model}:${this.task}`;return this.stream&&(r+="?alt=sse"),r}}async function v(e){var t;const n=new Headers;n.append("Content-Type","application/json"),n.append("x-goog-api-client",function(e){const t=[];return(null==e?void 0:e.apiClient)&&t.push(e.apiClient),t.push("genai-js/0.24.1"),t.join(" ")}(e.requestOptions)),n.append("x-goog-api-key",e.apiKey);let r=null===(t=e.requestOptions)||void 0===t?void 0:t.customHeaders;if(r){if(!(r instanceof Headers))try{r=new Headers(r)}catch(e){throw new y(`unable to convert customHeaders value ${JSON.stringify(r)} to Headers: ${e.message}`)}for(const[e,t]of r.entries()){if("x-goog-api-key"===e)throw new y(`Cannot set reserved header name ${e}`);if("x-goog-api-client"===e)throw new y(`Header name ${e} can only be set using the apiClient field`);n.append(e,t)}}return n}async function w(e,t,n,r,o,s={},a=fetch){const{url:i,fetchOptions:l}=await async function(e,t,n,r,o,s){const a=new k(e,t,n,r,s);return{url:a.toString(),fetchOptions:Object.assign(Object.assign({},x(s)),{method:"POST",headers:await v(a),body:o})}}(e,t,n,r,o,s);return async function(e,t,n=fetch){let r;try{r=await n(e,t)}catch(t){!function(e,t){let n=e;throw"AbortError"===n.name?(n=new b(`Request aborted when fetching ${t.toString()}: ${e.message}`),n.stack=e.stack):e instanceof m||e instanceof y||(n=new f(`Error fetching from ${t.toString()}: ${e.message}`),n.stack=e.stack),n}(t,e)}return r.ok||await async function(e,t){let n,r="";try{const t=await e.json();r=t.error.message,t.error.details&&(r+=` ${JSON.stringify(t.error.details)}`,n=t.error.details)}catch(e){}throw new m(`Error fetching from ${t.toString()}: [${e.status} ${e.statusText}] ${r}`,e.status,e.statusText,n)}(r,e),r}(i,l,a)}function x(e){const t={};if(void 0!==(null==e?void 0:e.signal)||(null==e?void 0:e.timeout)>=0){const n=new AbortController;(null==e?void 0:e.timeout)>=0&&setTimeout(()=>n.abort(),e.timeout),(null==e?void 0:e.signal)&&e.signal.addEventListener("abort",()=>{n.abort()}),t.signal=n.signal}return t}function E(e){return e.text=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),T(e.candidates[0]))throw new g(`${_(e)}`,e);return function(e){var t,n,r,o;const s=[];if(null===(n=null===(t=e.candidates)||void 0===t?void 0:t[0].content)||void 0===n?void 0:n.parts)for(const t of null===(o=null===(r=e.candidates)||void 0===r?void 0:r[0].content)||void 0===o?void 0:o.parts)t.text&&s.push(t.text),t.executableCode&&s.push("\n```"+t.executableCode.language+"\n"+t.executableCode.code+"\n```\n"),t.codeExecutionResult&&s.push("\n```\n"+t.codeExecutionResult.output+"\n```\n");return s.length>0?s.join(""):""}(e)}if(e.promptFeedback)throw new g(`Text not available. ${_(e)}`,e);return""},e.functionCall=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),T(e.candidates[0]))throw new g(`${_(e)}`,e);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),C(e)[0]}if(e.promptFeedback)throw new g(`Function call not available. ${_(e)}`,e)},e.functionCalls=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),T(e.candidates[0]))throw new g(`${_(e)}`,e);return C(e)}if(e.promptFeedback)throw new g(`Function call not available. ${_(e)}`,e)},e}function C(e){var t,n,r,o;const s=[];if(null===(n=null===(t=e.candidates)||void 0===t?void 0:t[0].content)||void 0===n?void 0:n.parts)for(const t of null===(o=null===(r=e.candidates)||void 0===r?void 0:r[0].content)||void 0===o?void 0:o.parts)t.functionCall&&s.push(t.functionCall);return s.length>0?s:void 0}const S=[c.RECITATION,c.SAFETY,c.LANGUAGE];function T(e){return!!e.finishReason&&S.includes(e.finishReason)}function _(e){var t,n,r;let o="";if(e.candidates&&0!==e.candidates.length||!e.promptFeedback){if(null===(r=e.candidates)||void 0===r?void 0:r[0]){const t=e.candidates[0];T(t)&&(o+=`Candidate was blocked due to ${t.finishReason}`,t.finishMessage&&(o+=`: ${t.finishMessage}`))}}else o+="Response was blocked",(null===(t=e.promptFeedback)||void 0===t?void 0:t.blockReason)&&(o+=` due to ${e.promptFeedback.blockReason}`),(null===(n=e.promptFeedback)||void 0===n?void 0:n.blockReasonMessage)&&(o+=`: ${e.promptFeedback.blockReasonMessage}`);return o}function I(e){return this instanceof I?(this.v=e,this):new I(e)}"function"==typeof SuppressedError&&SuppressedError;const A=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;async function R(e){const t=[],n=e.getReader();for(;;){const{done:e,value:r}=await n.read();if(e)return E(N(t));t.push(r)}}function O(e){return function(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,o=n.apply(e,t||[]),s=[];return r={},a("next"),a("throw"),a("return"),r[Symbol.asyncIterator]=function(){return this},r;function a(e){o[e]&&(r[e]=function(t){return new Promise(function(n,r){s.push([e,t,n,r])>1||i(e,t)})})}function i(e,t){try{(n=o[e](t)).value instanceof I?Promise.resolve(n.value.v).then(l,c):u(s[0][2],n)}catch(e){u(s[0][3],e)}var n}function l(e){i("next",e)}function c(e){i("throw",e)}function u(e,t){e(t),s.shift(),s.length&&i(s[0][0],s[0][1])}}(this,arguments,function*(){const t=e.getReader();for(;;){const{value:e,done:n}=yield I(t.read());if(n)break;yield yield I(E(e))}})}function N(e){const t=e[e.length-1],n={promptFeedback:null==t?void 0:t.promptFeedback};for(const t of e){if(t.candidates){let e=0;for(const r of t.candidates)if(n.candidates||(n.candidates=[]),n.candidates[e]||(n.candidates[e]={index:e}),n.candidates[e].citationMetadata=r.citationMetadata,n.candidates[e].groundingMetadata=r.groundingMetadata,n.candidates[e].finishReason=r.finishReason,n.candidates[e].finishMessage=r.finishMessage,n.candidates[e].safetyRatings=r.safetyRatings,r.content&&r.content.parts){n.candidates[e].content||(n.candidates[e].content={role:r.content.role||"user",parts:[]});const t={};for(const o of r.content.parts)o.text&&(t.text=o.text),o.functionCall&&(t.functionCall=o.functionCall),o.executableCode&&(t.executableCode=o.executableCode),o.codeExecutionResult&&(t.codeExecutionResult=o.codeExecutionResult),0===Object.keys(t).length&&(t.text=""),n.candidates[e].content.parts.push(t)}e++}t.usageMetadata&&(n.usageMetadata=t.usageMetadata)}return n}async function M(e,t,n,r){return function(e){const t=function(e){const t=e.getReader();return new ReadableStream({start(e){let n="";return function r(){return t.read().then(({value:t,done:o})=>{if(o)return n.trim()?void e.error(new f("Failed to parse stream")):void e.close();n+=t;let s,a=n.match(A);for(;a;){try{s=JSON.parse(a[1])}catch(t){return void e.error(new f(`Error parsing JSON response: "${a[1]}"`))}e.enqueue(s),n=n.substring(a[0].length),a=n.match(A)}return r()}).catch(e=>{let t=e;throw t.stack=e.stack,t="AbortError"===t.name?new b("Request aborted when reading from the stream"):new f("Error reading from the stream"),t})}()}})}(e.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0}))),[n,r]=t.tee();return{stream:O(n),response:R(r)}}(await w(t,p.STREAM_GENERATE_CONTENT,e,!0,JSON.stringify(n),r))}async function D(e,t,n,r){const o=await w(t,p.GENERATE_CONTENT,e,!1,JSON.stringify(n),r);return{response:E(await o.json())}}function L(e){if(null!=e)return"string"==typeof e?{role:"system",parts:[{text:e}]}:e.text?{role:"system",parts:[e]}:e.parts?e.role?e:{role:"system",parts:e.parts}:void 0}function P(e){let t=[];if("string"==typeof e)t=[{text:e}];else for(const n of e)"string"==typeof n?t.push({text:n}):t.push(n);return function(e){const t={role:"user",parts:[]},n={role:"function",parts:[]};let r=!1,o=!1;for(const s of e)"functionResponse"in s?(n.parts.push(s),o=!0):(t.parts.push(s),r=!0);if(r&&o)throw new f("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!r&&!o)throw new f("No content is provided for sending chat message.");return r?t:n}(t)}function $(e){let t;return t=e.contents?e:{contents:[P(e)]},e.systemInstruction&&(t.systemInstruction=L(e.systemInstruction)),t}const j=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],F={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function z(e){var t;if(void 0===e.candidates||0===e.candidates.length)return!1;const n=null===(t=e.candidates[0])||void 0===t?void 0:t.content;if(void 0===n)return!1;if(void 0===n.parts||0===n.parts.length)return!1;for(const e of n.parts){if(void 0===e||0===Object.keys(e).length)return!1;if(void 0!==e.text&&""===e.text)return!1}return!0}const U="SILENT_ERROR";class H{constructor(e,t,n,r={}){this.model=t,this.params=n,this._requestOptions=r,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=e,(null==n?void 0:n.history)&&(function(e){let t=!1;for(const n of e){const{role:e,parts:r}=n;if(!t&&"user"!==e)throw new f(`First content should be with role 'user', got ${e}`);if(!o.includes(e))throw new f(`Each item should include role field. Got ${e} but valid roles are: ${JSON.stringify(o)}`);if(!Array.isArray(r))throw new f("Content should have 'parts' property with an array of Parts");if(0===r.length)throw new f("Each Content should have at least one part");const s={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(const e of r)for(const t of j)t in e&&(s[t]+=1);const a=F[e];for(const t of j)if(!a.includes(t)&&s[t]>0)throw new f(`Content with role '${e}' can't contain '${t}' part`);t=!0}}(n.history),this._history=n.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(e,t={}){var n,r,o,s,a,i;await this._sendPromise;const l=P(e),c={safetySettings:null===(n=this.params)||void 0===n?void 0:n.safetySettings,generationConfig:null===(r=this.params)||void 0===r?void 0:r.generationConfig,tools:null===(o=this.params)||void 0===o?void 0:o.tools,toolConfig:null===(s=this.params)||void 0===s?void 0:s.toolConfig,systemInstruction:null===(a=this.params)||void 0===a?void 0:a.systemInstruction,cachedContent:null===(i=this.params)||void 0===i?void 0:i.cachedContent,contents:[...this._history,l]},u=Object.assign(Object.assign({},this._requestOptions),t);let h;return this._sendPromise=this._sendPromise.then(()=>D(this._apiKey,this.model,c,u)).then(e=>{var t;if(z(e.response)){this._history.push(l);const n=Object.assign({parts:[],role:"model"},null===(t=e.response.candidates)||void 0===t?void 0:t[0].content);this._history.push(n)}else{const t=_(e.response);t&&console.warn(`sendMessage() was unsuccessful. ${t}. Inspect response object for details.`)}h=e}).catch(e=>{throw this._sendPromise=Promise.resolve(),e}),await this._sendPromise,h}async sendMessageStream(e,t={}){var n,r,o,s,a,i;await this._sendPromise;const l=P(e),c={safetySettings:null===(n=this.params)||void 0===n?void 0:n.safetySettings,generationConfig:null===(r=this.params)||void 0===r?void 0:r.generationConfig,tools:null===(o=this.params)||void 0===o?void 0:o.tools,toolConfig:null===(s=this.params)||void 0===s?void 0:s.toolConfig,systemInstruction:null===(a=this.params)||void 0===a?void 0:a.systemInstruction,cachedContent:null===(i=this.params)||void 0===i?void 0:i.cachedContent,contents:[...this._history,l]},u=Object.assign(Object.assign({},this._requestOptions),t),h=M(this._apiKey,this.model,c,u);return this._sendPromise=this._sendPromise.then(()=>h).catch(e=>{throw new Error(U)}).then(e=>e.response).then(e=>{if(z(e)){this._history.push(l);const t=Object.assign({},e.candidates[0].content);t.role||(t.role="model"),this._history.push(t)}else{const t=_(e);t&&console.warn(`sendMessageStream() was unsuccessful. ${t}. Inspect response object for details.`)}}).catch(e=>{e.message!==U&&console.error(e)}),h}}class G{constructor(e,t,n={}){this.apiKey=e,this._requestOptions=n,t.model.includes("/")?this.model=t.model:this.model=`models/${t.model}`,this.generationConfig=t.generationConfig||{},this.safetySettings=t.safetySettings||[],this.tools=t.tools,this.toolConfig=t.toolConfig,this.systemInstruction=L(t.systemInstruction),this.cachedContent=t.cachedContent}async generateContent(e,t={}){var n;const r=$(e),o=Object.assign(Object.assign({},this._requestOptions),t);return D(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null===(n=this.cachedContent)||void 0===n?void 0:n.name},r),o)}async generateContentStream(e,t={}){var n;const r=$(e),o=Object.assign(Object.assign({},this._requestOptions),t);return M(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null===(n=this.cachedContent)||void 0===n?void 0:n.name},r),o)}startChat(e){var t;return new H(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null===(t=this.cachedContent)||void 0===t?void 0:t.name},e),this._requestOptions)}async countTokens(e,t={}){const n=function(e,t){var n;let r={model:null==t?void 0:t.model,generationConfig:null==t?void 0:t.generationConfig,safetySettings:null==t?void 0:t.safetySettings,tools:null==t?void 0:t.tools,toolConfig:null==t?void 0:t.toolConfig,systemInstruction:null==t?void 0:t.systemInstruction,cachedContent:null===(n=null==t?void 0:t.cachedContent)||void 0===n?void 0:n.name,contents:[]};const o=null!=e.generateContentRequest;if(e.contents){if(o)throw new y("CountTokensRequest must have one of contents or generateContentRequest, not both.");r.contents=e.contents}else if(o)r=Object.assign(Object.assign({},r),e.generateContentRequest);else{const t=P(e);r.contents=[t]}return{generateContentRequest:r}}(e,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),r=Object.assign(Object.assign({},this._requestOptions),t);return async function(e,t,n,r){return(await w(t,p.COUNT_TOKENS,e,!1,JSON.stringify(n),r)).json()}(this.apiKey,this.model,n,r)}async embedContent(e,t={}){const n="string"==typeof(o=e)||Array.isArray(o)?{content:P(o)}:o,r=Object.assign(Object.assign({},this._requestOptions),t);var o;return async function(e,t,n,r){return(await w(t,p.EMBED_CONTENT,e,!1,JSON.stringify(n),r)).json()}(this.apiKey,this.model,n,r)}async batchEmbedContents(e,t={}){const n=Object.assign(Object.assign({},this._requestOptions),t);return async function(e,t,n,r){const o=n.requests.map(e=>Object.assign(Object.assign({},e),{model:t}));return(await w(t,p.BATCH_EMBED_CONTENTS,e,!1,JSON.stringify({requests:o}),r)).json()}(this.apiKey,this.model,e,n)}}class q{constructor(e){this.apiKey=e}getGenerativeModel(e,t){if(!e.model)throw new f("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new G(this.apiKey,e,t)}getGenerativeModelFromCachedContent(e,t,n){if(!e.name)throw new y("Cached content must contain a `name` field.");if(!e.model)throw new y("Cached content must contain a `model` field.");const r=["model","systemInstruction"];for(const n of r)if((null==t?void 0:t[n])&&e[n]&&(null==t?void 0:t[n])!==e[n]){if("model"===n&&(t.model.startsWith("models/")?t.model.replace("models/",""):t.model)===(e.model.startsWith("models/")?e.model.replace("models/",""):e.model))continue;throw new y(`Different value for "${n}" specified in modelParams (${t[n]}) and cachedContent (${e[n]})`)}const o=Object.assign(Object.assign({},t),{model:e.model,tools:e.tools,toolConfig:e.toolConfig,systemInstruction:e.systemInstruction,cachedContent:e});return new G(this.apiKey,o,n)}}function B(e){return B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},B(e)}function Y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function K(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function s(n,r,o,s){var l=r&&r.prototype instanceof i?r:i,c=Object.create(l.prototype);return W(c,"_invoke",function(n,r,o){var s,i,l,c=0,u=o||[],h=!1,d={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return s=t,i=0,l=e,d.n=n,a}};function p(n,r){for(i=n,l=r,t=0;!h&&c&&!o&&t<u.length;t++){var o,s=u[t],p=d.p,f=s[2];n>3?(o=f===r)&&(l=s[(i=s[4])?5:(i=3,3)],s[4]=s[5]=e):s[0]<=p&&((o=n<2&&p<s[1])?(i=0,d.v=r,d.n=s[1]):p<f&&(o=n<3||s[0]>r||r>f)&&(s[4]=n,s[5]=r,d.n=f,i=0))}if(o||n>1)return a;throw h=!0,r}return function(o,u,f){if(c>1)throw TypeError("Generator is already running");for(h&&1===u&&p(u,f),i=u,l=f;(t=i<2?e:l)||!h;){s||(i?i<3?(i>1&&(d.n=-1),p(i,l)):d.n=l:d.v=l);try{if(c=2,s){if(i||(o="next"),t=s[o]){if(!(t=t.call(s,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,i<2&&(i=0)}else 1===i&&(t=s.return)&&t.call(s),i<2&&(l=TypeError("The iterator does not provide a '"+o+"' method"),i=1);s=e}else if((t=(h=d.n<0)?l:n.call(r,d))!==a)break}catch(t){s=e,i=1,l=t}finally{c=1}}return{value:t,done:h}}}(n,o,s),!0),c}var a={};function i(){}function l(){}function c(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(W(t={},r,function(){return this}),t),h=c.prototype=i.prototype=Object.create(u);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,W(e,o,"GeneratorFunction")),e.prototype=Object.create(h),e}return l.prototype=c,W(h,"constructor",c),W(c,"constructor",l),l.displayName="GeneratorFunction",W(c,o,"GeneratorFunction"),W(h),W(h,o,"Generator"),W(h,r,function(){return this}),W(h,"toString",function(){return"[object Generator]"}),(K=function(){return{w:s,m:d}})()}function W(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}W=function(e,t,n,r){function s(t,n){W(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(s("next",0),s("throw",1),s("return",2))},W(e,t,n,r)}function Q(e,t,n,r,o,s,a){try{var i=e[s](a),l=i.value}catch(e){return void n(e)}i.done?t(l):Promise.resolve(l).then(r,o)}function Z(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,X(r.key),r)}}function X(e){var t=function(e){if("object"!=B(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=B(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==B(t)?t:t+""}var V=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.CONFIG={GEMINI_API_KEY:"AIzaSyCNjd-fixqjwPek0626Y1Hn7criSFBcIuE",GEMINI_MODEL:"gemini-2.5-flash",MAX_HISTORY:12,MAX_CONTEXT_TOKENS:32e3},this.genAI=null,this.model=null,this.conversationHistory=[],this.chatSession=null},t=[{key:"initializeGemini",value:function(){try{if(!this.CONFIG.GEMINI_API_KEY||"YOUR_GEMINI_API_KEY_HERE"===this.CONFIG.GEMINI_API_KEY)throw new Error("Please configure your Gemini API key in the .env file");return this.genAI=new q(this.CONFIG.GEMINI_API_KEY),this.model=this.genAI.getGenerativeModel({model:this.CONFIG.GEMINI_MODEL}),this.conversationHistory=[],this.chatSession=null,console.log("Gemini AI initialized with model:",this.CONFIG.GEMINI_MODEL),!0}catch(e){throw console.error("Error initializing Gemini AI:",e),new Error("Failed to initialize AI service. Please check your API key.")}}},{key:"askGeminiWithContext",value:(n=K().m(function e(t,n){var r,o,s,a,i,l,c,u,h;return K().w(function(e){for(;;)switch(e.p=e.n){case 0:if(this.model){e.n=1;break}throw new Error("Gemini AI not initialized");case 1:if(n){e.n=2;break}throw new Error("No Excel data available");case 2:if(e.p=2,this.chatSession){e.n=3;break}return r=this.createAdvancedSystemPrompt(),this.chatSession=this.model.startChat({history:[],generationConfig:{maxOutputTokens:3072,temperature:.7,topP:.8,topK:40}}),e.n=3,this.chatSession.sendMessage(r);case 3:if(!((o=this.createAdvancedContextualPrompt(t,n)).length>3*this.CONFIG.MAX_CONTEXT_TOKENS)){e.n=6;break}return console.log("Large prompt detected, applying compression..."),s=this.compressPrompt(o,n),e.n=4,this.chatSession.sendMessage(s);case 4:return a=e.v,e.n=5,a.response;case 5:return i=e.v,e.a(2,i.text().trim());case 6:return e.n=7,this.chatSession.sendMessage(o);case 7:return l=e.v,e.n=8,l.response;case 8:if(c=e.v,(u=c.text())&&0!==u.trim().length){e.n=9;break}throw new Error("Empty response from AI");case 9:return e.a(2,u.trim());case 10:if(e.p=10,h=e.v,console.error("Gemini API error:",h),!h.message.includes("chat")&&!h.message.includes("session")){e.n=11;break}throw this.chatSession=null,new Error("Chat session reset. Please try your question again.");case 11:if(!h.message.includes("API key")){e.n=12;break}throw new Error("Invalid API key. Please check your Gemini API configuration.");case 12:if(!h.message.includes("quota")&&!h.message.includes("limit")){e.n=13;break}throw new Error("API quota exceeded. Please try again later.");case 13:throw new Error("AI service error: "+h.message);case 14:return e.a(2)}},e,this,[[2,10]])}),r=function(){var e=this,t=arguments;return new Promise(function(r,o){var s=n.apply(e,t);function a(e){Q(s,r,o,a,i,"next",e)}function i(e){Q(s,r,o,a,i,"throw",e)}a(void 0)})},function(e,t){return r.apply(this,arguments)})},{key:"createAdvancedSystemPrompt",value:function(){return'You are an elite Excel Financial Data Assistant with advanced capabilities for analyzing complex workbooks and financial models.\n\nENHANCED CAPABILITIES:\n1. **Advanced Data Structure Understanding**\n   - Analyze complex financial models with multiple sheets\n   - Understand formulas, calculated fields, and data relationships\n   - Recognize Excel Tables, PivotTables, Charts, and Named Ranges\n   - Handle very large datasets with intelligent sampling\n\n2. **Financial Expertise**\n   - Deep understanding of financial statements (P&L, Balance Sheet, Cash Flow)\n   - Recognition of financial metrics, ratios, and KPIs\n   - Quarterly/annual data analysis and trending\n   - Revenue recognition, expense categorization, and profitability analysis\n\n3. **Data Type Intelligence**\n   - Distinguish between raw data and calculated formulas\n   - Understand number formatting (currency, percentages, dates)\n   - Recognize data types and their business significance\n   - Handle mixed data types in complex financial models\n\n4. **Scale & Performance**\n   - Work with enterprise-scale financial models (100+ columns, 500+ rows)\n   - Understand sampling strategies for very large datasets\n   - Provide insights even with incomplete data views\n   - Maintain accuracy across multiple worksheet analysis\n\nANALYSIS APPROACH:\n- **Structure First**: Always understand the overall data structure before diving into specifics\n- **Context Aware**: Use conversation history and business context for better insights\n- **Precision**: Provide exact values from identified rows/columns with proper attribution\n- **Intelligent Sampling**: When working with sampled data, extrapolate insights appropriately\n- **Cross-Sheet Relationships**: Understand how different worksheets relate to each other\n\nRESPONSE GUIDELINES:\n- **Be CONCISE by default** - Provide brief, direct answers unless user asks for elaboration\n- Always specify the exact source of data (row labels, column headers)\n- When data is sampled, indicate this and provide appropriate caveats\n- Use clear formatting (tables, bullet points) for complex analysis\n- Provide actionable insights, not just data regurgitation\n- Ask clarifying questions when user intent is ambiguous\n- Keep responses short and focused - only expand when explicitly requested\n\nRespond with "Advanced Excel Analysis System Ready!" to confirm initialization.'}},{key:"createAdvancedContextualPrompt",value:function(e,t){var n=this,r=t,o='ADVANCED EXCEL DATA ANALYSIS REQUEST:\n\nWORKSHEET OVERVIEW:\n- Name: "'.concat(r.worksheetName,'"\n- Range: ').concat(r.address," (").concat(r.totalRows," rows × ").concat(r.totalCols," columns)\n- Data Source: ").concat(r.isSelection?"Selected Range":"Full Worksheet");if(r.isSampled&&(o+="\n- IMPORTANT: This is SAMPLED data for performance (intelligent sampling applied)\n- Original data may be much larger - extrapolate insights accordingly"),o+="\n\n",r.dataMetadata){var s,a,i,l,c,u,h=r.dataMetadata;((null===(s=h.tables)||void 0===s?void 0:s.length)>0||(null===(a=h.pivotTables)||void 0===a?void 0:a.length)>0||(null===(i=h.charts)||void 0===i?void 0:i.length)>0)&&(o+="EXCEL OBJECTS DETECTED:",(null===(l=h.tables)||void 0===l?void 0:l.length)>0&&(o+="\n- Excel Tables: ".concat(h.tables.map(function(e){return e.name}).join(", "))),(null===(c=h.pivotTables)||void 0===c?void 0:c.length)>0&&(o+="\n- Pivot Tables: ".concat(h.pivotTables.map(function(e){return e.name}).join(", "))),(null===(u=h.charts)||void 0===u?void 0:u.length)>0&&(o+="\n- Charts: ".concat(h.charts.map(function(e){return e.name}).join(", "))),h.hasNamedRanges&&(o+="\n- Named Ranges: Present"),o+="\n\n")}if(r.workbookData){var d=r.workbookData;o+="WORKBOOK STRUCTURE:\n- Total Sheets: ".concat(d.totalSheets,"\n- Total Data Cells: ").concat(d.totalDataCells.toLocaleString(),"\n- Other Sheets: ").concat(d.sheets.filter(function(e){return e.name!==r.worksheetName}).map(function(e){return"".concat(e.name," (").concat(e.totalCells," cells)")}).join(", "),"\n\n")}if(r.structuredData){var p,f,g,m,y,b,k,v,w=r.structuredData;if(o+="TABLE STRUCTURE ANALYSIS:\n- Data Type: ".concat(w.type,"\n- Column Headers: ").concat((null===(p=w.columnHeaders)||void 0===p?void 0:p.filter(function(e){return e&&""!==e}).join(" | "))||"Not detected","\n- Data Rows: ").concat((null===(f=w.dataRows)||void 0===f?void 0:f.length)||0,"\n- Key Financial Rows: ").concat((null===(g=w.keyRows)||void 0===g?void 0:g.length)||0,"\n- Total/Summary Rows: ").concat((null===(m=w.totalRows)||void 0===m?void 0:m.length)||0,"\n\n"),w.formulaAnalysis){var x=w.formulaAnalysis;x.hasFormulas&&(o+="FORMULA ANALYSIS:\n- Total Formulas: ".concat(x.formulaCount,"\n- Formula Types: ").concat(x.types.join(", "),"\n\n"))}if(null!==(y=w.formatAnalysis)&&void 0!==y&&y.hasFormatting){var E=w.formatAnalysis;o+="NUMBER FORMATTING:\n- Custom Formats: ".concat(E.types.slice(0,5).join(", ")).concat(E.types.length>5?"...":"","\n\n")}if(w.dataTypes){var C=w.dataTypes,S=Object.values(C).reduce(function(e,t){return e+t},0);S>0&&(o+="DATA TYPE DISTRIBUTION:",Object.entries(C).forEach(function(e){var t=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,s,a,i=[],l=!0,c=!1;try{if(s=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=s.call(n)).done)&&(i.push(r.value),i.length!==t);l=!0);}catch(e){c=!0,o=e}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Y(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Y(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(e,2),n=t[0],r=t[1];if(r>0){var s=(r/S*100).toFixed(1);o+="\n- ".concat(n,": ").concat(r," cells (").concat(s,"%)")}}),o+="\n\n")}if((null===(b=w.quarterlyData)||void 0===b?void 0:b.length)>0&&(o+="QUARTERLY/TIME-SERIES DATA:\n",w.quarterlyData.slice(0,8).forEach(function(e){if(e.quarters.length>0){o+="".concat(e.label).concat(e.isTotal?" [TOTAL]":"",": ");var t=e.quarters.map(function(e){return"".concat(e.quarter,"=").concat(n.formatValue(e.value))}).join(", ");o+=t+"\n"}}),w.quarterlyData.length>8&&(o+="... and ".concat(w.quarterlyData.length-8," more quarterly series\n")),o+="\n"),(null===(k=w.keyRows)||void 0===k?void 0:k.length)>0&&(o+="KEY FINANCIAL METRICS:\n",w.keyRows.slice(0,10).forEach(function(e){o+='"'.concat(e.label,'"').concat(e.isTotal?" [TOTAL]":"").concat(e.hasFormulas?" [CALCULATED]":"",": ");var t=e.values.filter(function(e){return null!=e&&""!==e});o+=t.slice(0,8).map(function(e){return n.formatValue(e)}).join(", "),t.length>8&&(o+=", ... (".concat(t.length-8," more)")),o+="\n"}),w.keyRows.length>10&&(o+="... and ".concat(w.keyRows.length-10," more key rows\n")),o+="\n"),w.dataRows&&w.dataRows.length>((null===(v=w.keyRows)||void 0===v?void 0:v.length)||0)){var T=w.dataRows.filter(function(e){return!(w.keyRows||[]).find(function(t){return t.label===e.label})}).slice(0,6);T.length>0&&(o+="OTHER DATA ROWS (sample):\n",T.forEach(function(e){o+='"'.concat(e.label,'"').concat(e.hasFormulas?" [CALCULATED]":"",": ");var t=e.values.filter(function(e){return null!=e&&""!==e});o+=t.slice(0,4).map(function(e){return n.formatValue(e)}).join(", "),t.length>4&&(o+=", ... (".concat(t.length-4," more)")),o+="\n"}),o+="\n")}}return this.conversationHistory.length>2&&(o+="CONVERSATION HISTORY:\n",this.conversationHistory.slice(-6).forEach(function(e,t){if("user"===e.role)o+="[".concat(t+1,'] User: "').concat(e.content,'"\n');else{var n=e.content.length>120?e.content.substring(0,120)+"...":e.content;o+="[".concat(t+1,'] Assistant: "').concat(n,'"\n')}}),o+="\n"),o+='CURRENT USER QUESTION: "'.concat(e,'"\n\nANALYSIS INSTRUCTIONS:\n1. **CONCISE RESPONSES**: Provide brief, focused answers - only elaborate when user asks for more detail\n2. **Data Source Precision**: Always specify exact row labels and column headers when referencing data\n3. **Context Utilization**: Use conversation history and business context for deeper insights\n4. **Sampling Awareness**: ').concat(r.isSampled?"Remember this is sampled data - provide appropriate caveats":"You have access to the complete dataset","\n5. **Formula Recognition**: Distinguish between raw input data and calculated/formula-based values\n6. **Financial Intelligence**: Apply financial analysis best practices and recognize common financial patterns\n7. **Multi-dimensional Analysis**: Consider time trends, cross-sectional comparisons, and ratio analysis\n8. **Actionable Insights**: Provide business-relevant conclusions, not just data summaries\n\nPlease provide a CONCISE analysis addressing the user's question. Keep it brief unless they specifically ask for more detail.")}},{key:"compressPrompt",value:function(e,t){var n=this,r=t,o='COMPRESSED EXCEL ANALYSIS (Large Dataset):\n\nWORKSHEET: "'.concat(r.worksheetName,'" | Range: ').concat(r.address," (").concat(r.totalRows,"×").concat(r.totalCols,")");if(r.isSampled&&(o+=" | SAMPLED DATA"),r.structuredData){var s,a,i,l,c,u=r.structuredData;o+="\n\nKEY STRUCTURE:\n- Headers: ".concat((null===(s=u.columnHeaders)||void 0===s?void 0:s.slice(0,10).join(" | "))||"N/A","\n- Key Rows: ").concat((null===(a=u.keyRows)||void 0===a?void 0:a.length)||0," | Data Rows: ").concat((null===(i=u.dataRows)||void 0===i?void 0:i.length)||0),(null===(l=u.keyRows)||void 0===l?void 0:l.length)>0&&(o+="\n\nTOP METRICS:",u.keyRows.slice(0,5).forEach(function(e){var t=e.values.filter(function(e){return null!=e&&""!==e}).slice(0,4);o+="\n".concat(e.label,": ").concat(t.map(function(e){return n.formatValue(e)}).join(", "))})),(null===(c=u.quarterlyData)||void 0===c?void 0:c.length)>0&&(o+="\n\nQUARTERLY: ".concat(u.quarterlyData.length," series | Example: ").concat(u.quarterlyData[0].label))}if(this.conversationHistory.length>0){var h=this.conversationHistory.slice(-2);o+="\n\nRECENT: ".concat(h.map(function(e){return"".concat(e.role,": ").concat(e.content.substring(0,50),"...")}).join(" | "))}return o+='\n\nQUESTION: "'.concat(userQuestion,'"\n\nNote: Provide focused analysis due to large dataset. Request specific details if needed.')}},{key:"formatValue",value:function(e){return null==e||""===e?"N/A":"number"==typeof e?Math.abs(e)>=1e6?(e/1e6).toFixed(1)+"M":Math.abs(e)>=1e3?(e/1e3).toFixed(1)+"K":e.toString():String(e).substring(0,20)}},{key:"addToConversationHistory",value:function(e,t){this.conversationHistory.push({role:e,content:t,timestamp:(new Date).toISOString()}),this.conversationHistory.length>2*this.CONFIG.MAX_HISTORY&&(this.conversationHistory=this.conversationHistory.slice(2*-this.CONFIG.MAX_HISTORY))}},{key:"clearConversation",value:function(){this.conversationHistory=[],this.chatSession=null,console.log("AI conversation history cleared")}},{key:"getConversationLength",value:function(){return Math.floor(this.conversationHistory.length/2)}},{key:"getConversationHistory",value:function(){return this.conversationHistory}},{key:"isInitialized",value:function(){return null!==this.model}}],t&&Z(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,r}();"undefined"!=typeof window&&(window.AIService=V);let J={async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null};function ee(e){J=e}const te=/[&<>"']/,ne=new RegExp(te.source,"g"),re=/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,oe=new RegExp(re.source,"g"),se={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},ae=e=>se[e];function ie(e,t){if(t){if(te.test(e))return e.replace(ne,ae)}else if(re.test(e))return e.replace(oe,ae);return e}const le=/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/gi;function ce(e){return e.replace(le,(e,t)=>"colon"===(t=t.toLowerCase())?":":"#"===t.charAt(0)?"x"===t.charAt(1)?String.fromCharCode(parseInt(t.substring(2),16)):String.fromCharCode(+t.substring(1)):"")}const ue=/(^|[^\[])\^/g;function he(e,t){e="string"==typeof e?e:e.source,t=t||"";const n={replace:(t,r)=>(r=(r="object"==typeof r&&"source"in r?r.source:r).replace(ue,"$1"),e=e.replace(t,r),n),getRegex:()=>new RegExp(e,t)};return n}function de(e){try{e=encodeURI(e).replace(/%25/g,"%")}catch(e){return null}return e}const pe={exec:()=>null};function fe(e,t){const n=e.replace(/\|/g,(e,t,n)=>{let r=!1,o=t;for(;--o>=0&&"\\"===n[o];)r=!r;return r?"|":" |"}).split(/ \|/);let r=0;if(n[0].trim()||n.shift(),n.length>0&&!n[n.length-1].trim()&&n.pop(),t)if(n.length>t)n.splice(t);else for(;n.length<t;)n.push("");for(;r<n.length;r++)n[r]=n[r].trim().replace(/\\\|/g,"|");return n}function ge(e,t,n){const r=e.length;if(0===r)return"";let o=0;for(;o<r;){const s=e.charAt(r-o-1);if(s!==t||n){if(s===t||!n)break;o++}else o++}return e.slice(0,r-o)}function me(e,t,n,r){const o=t.href,s=t.title?ie(t.title):null,a=e[1].replace(/\\([\[\]])/g,"$1");if("!"!==e[0].charAt(0)){r.state.inLink=!0;const e={type:"link",raw:n,href:o,title:s,text:a,tokens:r.inlineTokens(a)};return r.state.inLink=!1,e}return{type:"image",raw:n,href:o,title:s,text:ie(a)}}class ye{options;rules;lexer;constructor(e){this.options=e||J}space(e){const t=this.rules.block.newline.exec(e);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(e){const t=this.rules.block.code.exec(e);if(t){const e=t[0].replace(/^ {1,4}/gm,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?e:ge(e,"\n")}}}fences(e){const t=this.rules.block.fences.exec(e);if(t){const e=t[0],n=function(e,t){const n=e.match(/^(\s+)(?:```)/);if(null===n)return t;const r=n[1];return t.split("\n").map(e=>{const t=e.match(/^\s+/);if(null===t)return e;const[n]=t;return n.length>=r.length?e.slice(r.length):e}).join("\n")}(e,t[3]||"");return{type:"code",raw:e,lang:t[2]?t[2].trim().replace(this.rules.inline._escapes,"$1"):t[2],text:n}}}heading(e){const t=this.rules.block.heading.exec(e);if(t){let e=t[2].trim();if(/#$/.test(e)){const t=ge(e,"#");this.options.pedantic?e=t.trim():t&&!/ $/.test(t)||(e=t.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:e,tokens:this.lexer.inline(e)}}}hr(e){const t=this.rules.block.hr.exec(e);if(t)return{type:"hr",raw:t[0]}}blockquote(e){const t=this.rules.block.blockquote.exec(e);if(t){const e=ge(t[0].replace(/^ *>[ \t]?/gm,""),"\n"),n=this.lexer.state.top;this.lexer.state.top=!0;const r=this.lexer.blockTokens(e);return this.lexer.state.top=n,{type:"blockquote",raw:t[0],tokens:r,text:e}}}list(e){let t=this.rules.block.list.exec(e);if(t){let n=t[1].trim();const r=n.length>1,o={type:"list",raw:"",ordered:r,start:r?+n.slice(0,-1):"",loose:!1,items:[]};n=r?`\\d{1,9}\\${n.slice(-1)}`:`\\${n}`,this.options.pedantic&&(n=r?n:"[*+-]");const s=new RegExp(`^( {0,3}${n})((?:[\t ][^\\n]*)?(?:\\n|$))`);let a="",i="",l=!1;for(;e;){let n=!1;if(!(t=s.exec(e)))break;if(this.rules.block.hr.test(e))break;a=t[0],e=e.substring(a.length);let r=t[2].split("\n",1)[0].replace(/^\t+/,e=>" ".repeat(3*e.length)),c=e.split("\n",1)[0],u=0;this.options.pedantic?(u=2,i=r.trimStart()):(u=t[2].search(/[^ ]/),u=u>4?1:u,i=r.slice(u),u+=t[1].length);let h=!1;if(!r&&/^ *$/.test(c)&&(a+=c+"\n",e=e.substring(c.length+1),n=!0),!n){const t=new RegExp(`^ {0,${Math.min(3,u-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ \t][^\\n]*)?(?:\\n|$))`),n=new RegExp(`^ {0,${Math.min(3,u-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),o=new RegExp(`^ {0,${Math.min(3,u-1)}}(?:\`\`\`|~~~)`),s=new RegExp(`^ {0,${Math.min(3,u-1)}}#`);for(;e;){const l=e.split("\n",1)[0];if(c=l,this.options.pedantic&&(c=c.replace(/^ {1,4}(?=( {4})*[^ ])/g,"  ")),o.test(c))break;if(s.test(c))break;if(t.test(c))break;if(n.test(e))break;if(c.search(/[^ ]/)>=u||!c.trim())i+="\n"+c.slice(u);else{if(h)break;if(r.search(/[^ ]/)>=4)break;if(o.test(r))break;if(s.test(r))break;if(n.test(r))break;i+="\n"+c}h||c.trim()||(h=!0),a+=l+"\n",e=e.substring(l.length+1),r=c.slice(u)}}o.loose||(l?o.loose=!0:/\n *\n *$/.test(a)&&(l=!0));let d,p=null;this.options.gfm&&(p=/^\[[ xX]\] /.exec(i),p&&(d="[ ] "!==p[0],i=i.replace(/^\[[ xX]\] +/,""))),o.items.push({type:"list_item",raw:a,task:!!p,checked:d,loose:!1,text:i,tokens:[]}),o.raw+=a}o.items[o.items.length-1].raw=a.trimEnd(),o.items[o.items.length-1].text=i.trimEnd(),o.raw=o.raw.trimEnd();for(let e=0;e<o.items.length;e++)if(this.lexer.state.top=!1,o.items[e].tokens=this.lexer.blockTokens(o.items[e].text,[]),!o.loose){const t=o.items[e].tokens.filter(e=>"space"===e.type),n=t.length>0&&t.some(e=>/\n.*\n/.test(e.raw));o.loose=n}if(o.loose)for(let e=0;e<o.items.length;e++)o.items[e].loose=!0;return o}}html(e){const t=this.rules.block.html.exec(e);if(t)return{type:"html",block:!0,raw:t[0],pre:"pre"===t[1]||"script"===t[1]||"style"===t[1],text:t[0]}}def(e){const t=this.rules.block.def.exec(e);if(t){const e=t[1].toLowerCase().replace(/\s+/g," "),n=t[2]?t[2].replace(/^<(.*)>$/,"$1").replace(this.rules.inline._escapes,"$1"):"",r=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline._escapes,"$1"):t[3];return{type:"def",tag:e,raw:t[0],href:n,title:r}}}table(e){const t=this.rules.block.table.exec(e);if(t){if(!/[:|]/.test(t[2]))return;const e={type:"table",raw:t[0],header:fe(t[1]).map(e=>({text:e,tokens:[]})),align:t[2].replace(/^\||\| *$/g,"").split("|"),rows:t[3]&&t[3].trim()?t[3].replace(/\n[ \t]*$/,"").split("\n"):[]};if(e.header.length===e.align.length){let t,n,r,o,s=e.align.length;for(t=0;t<s;t++){const n=e.align[t];n&&(/^ *-+: *$/.test(n)?e.align[t]="right":/^ *:-+: *$/.test(n)?e.align[t]="center":/^ *:-+ *$/.test(n)?e.align[t]="left":e.align[t]=null)}for(s=e.rows.length,t=0;t<s;t++)e.rows[t]=fe(e.rows[t],e.header.length).map(e=>({text:e,tokens:[]}));for(s=e.header.length,n=0;n<s;n++)e.header[n].tokens=this.lexer.inline(e.header[n].text);for(s=e.rows.length,n=0;n<s;n++)for(o=e.rows[n],r=0;r<o.length;r++)o[r].tokens=this.lexer.inline(o[r].text);return e}}}lheading(e){const t=this.rules.block.lheading.exec(e);if(t)return{type:"heading",raw:t[0],depth:"="===t[2].charAt(0)?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(e){const t=this.rules.block.paragraph.exec(e);if(t){const e="\n"===t[1].charAt(t[1].length-1)?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:e,tokens:this.lexer.inline(e)}}}text(e){const t=this.rules.block.text.exec(e);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(e){const t=this.rules.inline.escape.exec(e);if(t)return{type:"escape",raw:t[0],text:ie(t[1])}}tag(e){const t=this.rules.inline.tag.exec(e);if(t)return!this.lexer.state.inLink&&/^<a /i.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&/^<\/a>/i.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&/^<(pre|code|kbd|script)(\s|>)/i.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}link(e){const t=this.rules.inline.link.exec(e);if(t){const e=t[2].trim();if(!this.options.pedantic&&/^</.test(e)){if(!/>$/.test(e))return;const t=ge(e.slice(0,-1),"\\");if((e.length-t.length)%2==0)return}else{const e=function(e,t){if(-1===e.indexOf(t[1]))return-1;let n=0;for(let r=0;r<e.length;r++)if("\\"===e[r])r++;else if(e[r]===t[0])n++;else if(e[r]===t[1]&&(n--,n<0))return r;return-1}(t[2],"()");if(e>-1){const n=(0===t[0].indexOf("!")?5:4)+t[1].length+e;t[2]=t[2].substring(0,e),t[0]=t[0].substring(0,n).trim(),t[3]=""}}let n=t[2],r="";if(this.options.pedantic){const e=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec(n);e&&(n=e[1],r=e[3])}else r=t[3]?t[3].slice(1,-1):"";return n=n.trim(),/^</.test(n)&&(n=this.options.pedantic&&!/>$/.test(e)?n.slice(1):n.slice(1,-1)),me(t,{href:n?n.replace(this.rules.inline._escapes,"$1"):n,title:r?r.replace(this.rules.inline._escapes,"$1"):r},t[0],this.lexer)}}reflink(e,t){let n;if((n=this.rules.inline.reflink.exec(e))||(n=this.rules.inline.nolink.exec(e))){let e=(n[2]||n[1]).replace(/\s+/g," ");if(e=t[e.toLowerCase()],!e){const e=n[0].charAt(0);return{type:"text",raw:e,text:e}}return me(n,e,n[0],this.lexer)}}emStrong(e,t,n=""){let r=this.rules.inline.emStrong.lDelim.exec(e);if(r&&(!r[3]||!n.match(/[\p{L}\p{N}]/u))&&(!r[1]&&!r[2]||!n||this.rules.inline.punctuation.exec(n))){const n=[...r[0]].length-1;let o,s,a=n,i=0;const l="*"===r[0][0]?this.rules.inline.emStrong.rDelimAst:this.rules.inline.emStrong.rDelimUnd;for(l.lastIndex=0,t=t.slice(-1*e.length+n);null!=(r=l.exec(t));){if(o=r[1]||r[2]||r[3]||r[4]||r[5]||r[6],!o)continue;if(s=[...o].length,r[3]||r[4]){a+=s;continue}if((r[5]||r[6])&&n%3&&!((n+s)%3)){i+=s;continue}if(a-=s,a>0)continue;s=Math.min(s,s+a+i);const t=[...r[0]][0].length,l=e.slice(0,n+r.index+t+s);if(Math.min(n,s)%2){const e=l.slice(1,-1);return{type:"em",raw:l,text:e,tokens:this.lexer.inlineTokens(e)}}const c=l.slice(2,-2);return{type:"strong",raw:l,text:c,tokens:this.lexer.inlineTokens(c)}}}}codespan(e){const t=this.rules.inline.code.exec(e);if(t){let e=t[2].replace(/\n/g," ");const n=/[^ ]/.test(e),r=/^ /.test(e)&&/ $/.test(e);return n&&r&&(e=e.substring(1,e.length-1)),e=ie(e,!0),{type:"codespan",raw:t[0],text:e}}}br(e){const t=this.rules.inline.br.exec(e);if(t)return{type:"br",raw:t[0]}}del(e){const t=this.rules.inline.del.exec(e);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(e){const t=this.rules.inline.autolink.exec(e);if(t){let e,n;return"@"===t[2]?(e=ie(t[1]),n="mailto:"+e):(e=ie(t[1]),n=e),{type:"link",raw:t[0],text:e,href:n,tokens:[{type:"text",raw:e,text:e}]}}}url(e){let t;if(t=this.rules.inline.url.exec(e)){let e,n;if("@"===t[2])e=ie(t[0]),n="mailto:"+e;else{let r;do{r=t[0],t[0]=this.rules.inline._backpedal.exec(t[0])[0]}while(r!==t[0]);e=ie(t[0]),n="www."===t[1]?"http://"+t[0]:t[0]}return{type:"link",raw:t[0],text:e,href:n,tokens:[{type:"text",raw:e,text:e}]}}}inlineText(e){const t=this.rules.inline.text.exec(e);if(t){let e;return e=this.lexer.state.inRawBlock?t[0]:ie(t[0]),{type:"text",raw:t[0],text:e}}}}const be={newline:/^(?: *(?:\n|$))+/,code:/^( {4}[^\n]+(?:\n(?: *(?:\n|$))*)?)+/,fences:/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,hr:/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,heading:/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,blockquote:/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/,list:/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/,html:"^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n *)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$))",def:/^ {0,3}\[(label)\]: *(?:\n *)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n *)?| *\n *)(title))? *(?:\n+|$)/,table:pe,lheading:/^(?!bull )((?:.|\n(?!\s*?\n|bull ))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,_paragraph:/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,text:/^[^\n]+/,_label:/(?!\s*\])(?:\\.|[^\[\]\\])+/,_title:/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/};be.def=he(be.def).replace("label",be._label).replace("title",be._title).getRegex(),be.bullet=/(?:[*+-]|\d{1,9}[.)])/,be.listItemStart=he(/^( *)(bull) */).replace("bull",be.bullet).getRegex(),be.list=he(be.list).replace(/bull/g,be.bullet).replace("hr","\\n+(?=\\1?(?:(?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$))").replace("def","\\n+(?="+be.def.source+")").getRegex(),be._tag="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",be._comment=/<!--(?!-?>)[\s\S]*?(?:-->|$)/,be.html=he(be.html,"i").replace("comment",be._comment).replace("tag",be._tag).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),be.lheading=he(be.lheading).replace(/bull/g,be.bullet).getRegex(),be.paragraph=he(be._paragraph).replace("hr",be.hr).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",be._tag).getRegex(),be.blockquote=he(be.blockquote).replace("paragraph",be.paragraph).getRegex(),be.normal={...be},be.gfm={...be.normal,table:"^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)"},be.gfm.table=he(be.gfm.table).replace("hr",be.hr).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",be._tag).getRegex(),be.gfm.paragraph=he(be._paragraph).replace("hr",be.hr).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",be.gfm.table).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",be._tag).getRegex(),be.pedantic={...be.normal,html:he("^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:\"[^\"]*\"|'[^']*'|\\s[^'\"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))").replace("comment",be._comment).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:pe,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:he(be.normal._paragraph).replace("hr",be.hr).replace("heading"," *#{1,6} *[^\n]").replace("lheading",be.lheading).replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").getRegex()};const ke={escape:/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,autolink:/^<(scheme:[^\s\x00-\x1f<>]*|email)>/,url:pe,tag:"^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>",link:/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/,reflink:/^!?\[(label)\]\[(ref)\]/,nolink:/^!?\[(ref)\](?:\[\])?/,reflinkSearch:"reflink|nolink(?!\\()",emStrong:{lDelim:/^(?:\*+(?:((?!\*)[punct])|[^\s*]))|^_+(?:((?!_)[punct])|([^\s_]))/,rDelimAst:/^[^_*]*?__[^_*]*?\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\*)[punct](\*+)(?=[\s]|$)|[^punct\s](\*+)(?!\*)(?=[punct\s]|$)|(?!\*)[punct\s](\*+)(?=[^punct\s])|[\s](\*+)(?!\*)(?=[punct])|(?!\*)[punct](\*+)(?!\*)(?=[punct])|[^punct\s](\*+)(?=[^punct\s])/,rDelimUnd:/^[^_*]*?\*\*[^_*]*?_[^_*]*?(?=\*\*)|[^_]+(?=[^_])|(?!_)[punct](_+)(?=[\s]|$)|[^punct\s](_+)(?!_)(?=[punct\s]|$)|(?!_)[punct\s](_+)(?=[^punct\s])|[\s](_+)(?!_)(?=[punct])|(?!_)[punct](_+)(?!_)(?=[punct])/},code:/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,br:/^( {2,}|\\)\n(?!\s*$)/,del:pe,text:/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,punctuation:/^((?![*_])[\spunctuation])/,_punctuation:"\\p{P}$+<=>`^|~"};ke.punctuation=he(ke.punctuation,"u").replace(/punctuation/g,ke._punctuation).getRegex(),ke.blockSkip=/\[[^[\]]*?\]\([^\(\)]*?\)|`[^`]*?`|<[^<>]*?>/g,ke.anyPunctuation=/\\[punct]/g,ke._escapes=/\\([punct])/g,ke._comment=he(be._comment).replace("(?:--\x3e|$)","--\x3e").getRegex(),ke.emStrong.lDelim=he(ke.emStrong.lDelim,"u").replace(/punct/g,ke._punctuation).getRegex(),ke.emStrong.rDelimAst=he(ke.emStrong.rDelimAst,"gu").replace(/punct/g,ke._punctuation).getRegex(),ke.emStrong.rDelimUnd=he(ke.emStrong.rDelimUnd,"gu").replace(/punct/g,ke._punctuation).getRegex(),ke.anyPunctuation=he(ke.anyPunctuation,"gu").replace(/punct/g,ke._punctuation).getRegex(),ke._escapes=he(ke._escapes,"gu").replace(/punct/g,ke._punctuation).getRegex(),ke._scheme=/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/,ke._email=/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/,ke.autolink=he(ke.autolink).replace("scheme",ke._scheme).replace("email",ke._email).getRegex(),ke._attribute=/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/,ke.tag=he(ke.tag).replace("comment",ke._comment).replace("attribute",ke._attribute).getRegex(),ke._label=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,ke._href=/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/,ke._title=/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/,ke.link=he(ke.link).replace("label",ke._label).replace("href",ke._href).replace("title",ke._title).getRegex(),ke.reflink=he(ke.reflink).replace("label",ke._label).replace("ref",be._label).getRegex(),ke.nolink=he(ke.nolink).replace("ref",be._label).getRegex(),ke.reflinkSearch=he(ke.reflinkSearch,"g").replace("reflink",ke.reflink).replace("nolink",ke.nolink).getRegex(),ke.normal={...ke},ke.pedantic={...ke.normal,strong:{start:/^__|\*\*/,middle:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,endAst:/\*\*(?!\*)/g,endUnd:/__(?!_)/g},em:{start:/^_|\*/,middle:/^()\*(?=\S)([\s\S]*?\S)\*(?!\*)|^_(?=\S)([\s\S]*?\S)_(?!_)/,endAst:/\*(?!\*)/g,endUnd:/_(?!_)/g},link:he(/^!?\[(label)\]\((.*?)\)/).replace("label",ke._label).getRegex(),reflink:he(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",ke._label).getRegex()},ke.gfm={...ke.normal,escape:he(ke.escape).replace("])","~|])").getRegex(),_extended_email:/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/,url:/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])([\s\S]*?[^\s~])\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},ke.gfm.url=he(ke.gfm.url,"i").replace("email",ke.gfm._extended_email).getRegex(),ke.breaks={...ke.gfm,br:he(ke.br).replace("{2,}","*").getRegex(),text:he(ke.gfm.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()};class ve{tokens;options;state;tokenizer;inlineQueue;constructor(e){this.tokens=[],this.tokens.links=Object.create(null),this.options=e||J,this.options.tokenizer=this.options.tokenizer||new ye,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const t={block:be.normal,inline:ke.normal};this.options.pedantic?(t.block=be.pedantic,t.inline=ke.pedantic):this.options.gfm&&(t.block=be.gfm,this.options.breaks?t.inline=ke.breaks:t.inline=ke.gfm),this.tokenizer.rules=t}static get rules(){return{block:be,inline:ke}}static lex(e,t){return new ve(t).lex(e)}static lexInline(e,t){return new ve(t).inlineTokens(e)}lex(e){let t;for(e=e.replace(/\r\n|\r/g,"\n"),this.blockTokens(e,this.tokens);t=this.inlineQueue.shift();)this.inlineTokens(t.src,t.tokens);return this.tokens}blockTokens(e,t=[]){let n,r,o,s;for(e=this.options.pedantic?e.replace(/\t/g,"    ").replace(/^ +$/gm,""):e.replace(/^( *)(\t+)/gm,(e,t,n)=>t+"    ".repeat(n.length));e;)if(!(this.options.extensions&&this.options.extensions.block&&this.options.extensions.block.some(r=>!!(n=r.call({lexer:this},e,t))&&(e=e.substring(n.raw.length),t.push(n),!0))))if(n=this.tokenizer.space(e))e=e.substring(n.raw.length),1===n.raw.length&&t.length>0?t[t.length-1].raw+="\n":t.push(n);else if(n=this.tokenizer.code(e))e=e.substring(n.raw.length),r=t[t.length-1],!r||"paragraph"!==r.type&&"text"!==r.type?t.push(n):(r.raw+="\n"+n.raw,r.text+="\n"+n.text,this.inlineQueue[this.inlineQueue.length-1].src=r.text);else if(n=this.tokenizer.fences(e))e=e.substring(n.raw.length),t.push(n);else if(n=this.tokenizer.heading(e))e=e.substring(n.raw.length),t.push(n);else if(n=this.tokenizer.hr(e))e=e.substring(n.raw.length),t.push(n);else if(n=this.tokenizer.blockquote(e))e=e.substring(n.raw.length),t.push(n);else if(n=this.tokenizer.list(e))e=e.substring(n.raw.length),t.push(n);else if(n=this.tokenizer.html(e))e=e.substring(n.raw.length),t.push(n);else if(n=this.tokenizer.def(e))e=e.substring(n.raw.length),r=t[t.length-1],!r||"paragraph"!==r.type&&"text"!==r.type?this.tokens.links[n.tag]||(this.tokens.links[n.tag]={href:n.href,title:n.title}):(r.raw+="\n"+n.raw,r.text+="\n"+n.raw,this.inlineQueue[this.inlineQueue.length-1].src=r.text);else if(n=this.tokenizer.table(e))e=e.substring(n.raw.length),t.push(n);else if(n=this.tokenizer.lheading(e))e=e.substring(n.raw.length),t.push(n);else{if(o=e,this.options.extensions&&this.options.extensions.startBlock){let t=1/0;const n=e.slice(1);let r;this.options.extensions.startBlock.forEach(e=>{r=e.call({lexer:this},n),"number"==typeof r&&r>=0&&(t=Math.min(t,r))}),t<1/0&&t>=0&&(o=e.substring(0,t+1))}if(this.state.top&&(n=this.tokenizer.paragraph(o)))r=t[t.length-1],s&&"paragraph"===r.type?(r.raw+="\n"+n.raw,r.text+="\n"+n.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=r.text):t.push(n),s=o.length!==e.length,e=e.substring(n.raw.length);else if(n=this.tokenizer.text(e))e=e.substring(n.raw.length),r=t[t.length-1],r&&"text"===r.type?(r.raw+="\n"+n.raw,r.text+="\n"+n.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=r.text):t.push(n);else if(e){const t="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(t);break}throw new Error(t)}}return this.state.top=!0,t}inline(e,t=[]){return this.inlineQueue.push({src:e,tokens:t}),t}inlineTokens(e,t=[]){let n,r,o,s,a,i,l=e;if(this.tokens.links){const e=Object.keys(this.tokens.links);if(e.length>0)for(;null!=(s=this.tokenizer.rules.inline.reflinkSearch.exec(l));)e.includes(s[0].slice(s[0].lastIndexOf("[")+1,-1))&&(l=l.slice(0,s.index)+"["+"a".repeat(s[0].length-2)+"]"+l.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;null!=(s=this.tokenizer.rules.inline.blockSkip.exec(l));)l=l.slice(0,s.index)+"["+"a".repeat(s[0].length-2)+"]"+l.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;null!=(s=this.tokenizer.rules.inline.anyPunctuation.exec(l));)l=l.slice(0,s.index)+"++"+l.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;e;)if(a||(i=""),a=!1,!(this.options.extensions&&this.options.extensions.inline&&this.options.extensions.inline.some(r=>!!(n=r.call({lexer:this},e,t))&&(e=e.substring(n.raw.length),t.push(n),!0))))if(n=this.tokenizer.escape(e))e=e.substring(n.raw.length),t.push(n);else if(n=this.tokenizer.tag(e))e=e.substring(n.raw.length),r=t[t.length-1],r&&"text"===n.type&&"text"===r.type?(r.raw+=n.raw,r.text+=n.text):t.push(n);else if(n=this.tokenizer.link(e))e=e.substring(n.raw.length),t.push(n);else if(n=this.tokenizer.reflink(e,this.tokens.links))e=e.substring(n.raw.length),r=t[t.length-1],r&&"text"===n.type&&"text"===r.type?(r.raw+=n.raw,r.text+=n.text):t.push(n);else if(n=this.tokenizer.emStrong(e,l,i))e=e.substring(n.raw.length),t.push(n);else if(n=this.tokenizer.codespan(e))e=e.substring(n.raw.length),t.push(n);else if(n=this.tokenizer.br(e))e=e.substring(n.raw.length),t.push(n);else if(n=this.tokenizer.del(e))e=e.substring(n.raw.length),t.push(n);else if(n=this.tokenizer.autolink(e))e=e.substring(n.raw.length),t.push(n);else if(this.state.inLink||!(n=this.tokenizer.url(e))){if(o=e,this.options.extensions&&this.options.extensions.startInline){let t=1/0;const n=e.slice(1);let r;this.options.extensions.startInline.forEach(e=>{r=e.call({lexer:this},n),"number"==typeof r&&r>=0&&(t=Math.min(t,r))}),t<1/0&&t>=0&&(o=e.substring(0,t+1))}if(n=this.tokenizer.inlineText(o))e=e.substring(n.raw.length),"_"!==n.raw.slice(-1)&&(i=n.raw.slice(-1)),a=!0,r=t[t.length-1],r&&"text"===r.type?(r.raw+=n.raw,r.text+=n.text):t.push(n);else if(e){const t="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(t);break}throw new Error(t)}}else e=e.substring(n.raw.length),t.push(n);return t}}class we{options;constructor(e){this.options=e||J}code(e,t,n){const r=(t||"").match(/^\S*/)?.[0];return e=e.replace(/\n$/,"")+"\n",r?'<pre><code class="language-'+ie(r)+'">'+(n?e:ie(e,!0))+"</code></pre>\n":"<pre><code>"+(n?e:ie(e,!0))+"</code></pre>\n"}blockquote(e){return`<blockquote>\n${e}</blockquote>\n`}html(e,t){return e}heading(e,t,n){return`<h${t}>${e}</h${t}>\n`}hr(){return"<hr>\n"}list(e,t,n){const r=t?"ol":"ul";return"<"+r+(t&&1!==n?' start="'+n+'"':"")+">\n"+e+"</"+r+">\n"}listitem(e,t,n){return`<li>${e}</li>\n`}checkbox(e){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph(e){return`<p>${e}</p>\n`}table(e,t){return t&&(t=`<tbody>${t}</tbody>`),"<table>\n<thead>\n"+e+"</thead>\n"+t+"</table>\n"}tablerow(e){return`<tr>\n${e}</tr>\n`}tablecell(e,t){const n=t.header?"th":"td";return(t.align?`<${n} align="${t.align}">`:`<${n}>`)+e+`</${n}>\n`}strong(e){return`<strong>${e}</strong>`}em(e){return`<em>${e}</em>`}codespan(e){return`<code>${e}</code>`}br(){return"<br>"}del(e){return`<del>${e}</del>`}link(e,t,n){const r=de(e);if(null===r)return n;let o='<a href="'+(e=r)+'"';return t&&(o+=' title="'+t+'"'),o+=">"+n+"</a>",o}image(e,t,n){const r=de(e);if(null===r)return n;let o=`<img src="${e=r}" alt="${n}"`;return t&&(o+=` title="${t}"`),o+=">",o}text(e){return e}}class xe{strong(e){return e}em(e){return e}codespan(e){return e}del(e){return e}html(e){return e}text(e){return e}link(e,t,n){return""+n}image(e,t,n){return""+n}br(){return""}}class Ee{options;renderer;textRenderer;constructor(e){this.options=e||J,this.options.renderer=this.options.renderer||new we,this.renderer=this.options.renderer,this.renderer.options=this.options,this.textRenderer=new xe}static parse(e,t){return new Ee(t).parse(e)}static parseInline(e,t){return new Ee(t).parseInline(e)}parse(e,t=!0){let n="";for(let r=0;r<e.length;r++){const o=e[r];if(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[o.type]){const e=o,t=this.options.extensions.renderers[e.type].call({parser:this},e);if(!1!==t||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(e.type)){n+=t||"";continue}}switch(o.type){case"space":continue;case"hr":n+=this.renderer.hr();continue;case"heading":{const e=o;n+=this.renderer.heading(this.parseInline(e.tokens),e.depth,ce(this.parseInline(e.tokens,this.textRenderer)));continue}case"code":{const e=o;n+=this.renderer.code(e.text,e.lang,!!e.escaped);continue}case"table":{const e=o;let t="",r="";for(let t=0;t<e.header.length;t++)r+=this.renderer.tablecell(this.parseInline(e.header[t].tokens),{header:!0,align:e.align[t]});t+=this.renderer.tablerow(r);let s="";for(let t=0;t<e.rows.length;t++){const n=e.rows[t];r="";for(let t=0;t<n.length;t++)r+=this.renderer.tablecell(this.parseInline(n[t].tokens),{header:!1,align:e.align[t]});s+=this.renderer.tablerow(r)}n+=this.renderer.table(t,s);continue}case"blockquote":{const e=o,t=this.parse(e.tokens);n+=this.renderer.blockquote(t);continue}case"list":{const e=o,t=e.ordered,r=e.start,s=e.loose;let a="";for(let t=0;t<e.items.length;t++){const n=e.items[t],r=n.checked,o=n.task;let i="";if(n.task){const e=this.renderer.checkbox(!!r);s?n.tokens.length>0&&"paragraph"===n.tokens[0].type?(n.tokens[0].text=e+" "+n.tokens[0].text,n.tokens[0].tokens&&n.tokens[0].tokens.length>0&&"text"===n.tokens[0].tokens[0].type&&(n.tokens[0].tokens[0].text=e+" "+n.tokens[0].tokens[0].text)):n.tokens.unshift({type:"text",text:e+" "}):i+=e+" "}i+=this.parse(n.tokens,s),a+=this.renderer.listitem(i,o,!!r)}n+=this.renderer.list(a,t,r);continue}case"html":{const e=o;n+=this.renderer.html(e.text,e.block);continue}case"paragraph":{const e=o;n+=this.renderer.paragraph(this.parseInline(e.tokens));continue}case"text":{let s=o,a=s.tokens?this.parseInline(s.tokens):s.text;for(;r+1<e.length&&"text"===e[r+1].type;)s=e[++r],a+="\n"+(s.tokens?this.parseInline(s.tokens):s.text);n+=t?this.renderer.paragraph(a):a;continue}default:{const e='Token with "'+o.type+'" type was not found.';if(this.options.silent)return console.error(e),"";throw new Error(e)}}}return n}parseInline(e,t){t=t||this.renderer;let n="";for(let r=0;r<e.length;r++){const o=e[r];if(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[o.type]){const e=this.options.extensions.renderers[o.type].call({parser:this},o);if(!1!==e||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(o.type)){n+=e||"";continue}}switch(o.type){case"escape":{const e=o;n+=t.text(e.text);break}case"html":{const e=o;n+=t.html(e.text);break}case"link":{const e=o;n+=t.link(e.href,e.title,this.parseInline(e.tokens,t));break}case"image":{const e=o;n+=t.image(e.href,e.title,e.text);break}case"strong":{const e=o;n+=t.strong(this.parseInline(e.tokens,t));break}case"em":{const e=o;n+=t.em(this.parseInline(e.tokens,t));break}case"codespan":{const e=o;n+=t.codespan(e.text);break}case"br":n+=t.br();break;case"del":{const e=o;n+=t.del(this.parseInline(e.tokens,t));break}case"text":{const e=o;n+=t.text(e.text);break}default:{const e='Token with "'+o.type+'" type was not found.';if(this.options.silent)return console.error(e),"";throw new Error(e)}}}return n}}class Ce{options;constructor(e){this.options=e||J}static passThroughHooks=new Set(["preprocess","postprocess"]);preprocess(e){return e}postprocess(e){return e}}const Se=new class{defaults={async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null};options=this.setOptions;parse=this.#e(ve.lex,Ee.parse);parseInline=this.#e(ve.lexInline,Ee.parseInline);Parser=Ee;Renderer=we;TextRenderer=xe;Lexer=ve;Tokenizer=ye;Hooks=Ce;constructor(...e){this.use(...e)}walkTokens(e,t){let n=[];for(const r of e)switch(n=n.concat(t.call(this,r)),r.type){case"table":{const e=r;for(const r of e.header)n=n.concat(this.walkTokens(r.tokens,t));for(const r of e.rows)for(const e of r)n=n.concat(this.walkTokens(e.tokens,t));break}case"list":{const e=r;n=n.concat(this.walkTokens(e.items,t));break}default:{const e=r;this.defaults.extensions?.childTokens?.[e.type]?this.defaults.extensions.childTokens[e.type].forEach(r=>{n=n.concat(this.walkTokens(e[r],t))}):e.tokens&&(n=n.concat(this.walkTokens(e.tokens,t)))}}return n}use(...e){const t=this.defaults.extensions||{renderers:{},childTokens:{}};return e.forEach(e=>{const n={...e};if(n.async=this.defaults.async||n.async||!1,e.extensions&&(e.extensions.forEach(e=>{if(!e.name)throw new Error("extension name required");if("renderer"in e){const n=t.renderers[e.name];t.renderers[e.name]=n?function(...t){let r=e.renderer.apply(this,t);return!1===r&&(r=n.apply(this,t)),r}:e.renderer}if("tokenizer"in e){if(!e.level||"block"!==e.level&&"inline"!==e.level)throw new Error("extension level must be 'block' or 'inline'");const n=t[e.level];n?n.unshift(e.tokenizer):t[e.level]=[e.tokenizer],e.start&&("block"===e.level?t.startBlock?t.startBlock.push(e.start):t.startBlock=[e.start]:"inline"===e.level&&(t.startInline?t.startInline.push(e.start):t.startInline=[e.start]))}"childTokens"in e&&e.childTokens&&(t.childTokens[e.name]=e.childTokens)}),n.extensions=t),e.renderer){const t=this.defaults.renderer||new we(this.defaults);for(const n in e.renderer){const r=e.renderer[n],o=n,s=t[o];t[o]=(...e)=>{let n=r.apply(t,e);return!1===n&&(n=s.apply(t,e)),n||""}}n.renderer=t}if(e.tokenizer){const t=this.defaults.tokenizer||new ye(this.defaults);for(const n in e.tokenizer){const r=e.tokenizer[n],o=n,s=t[o];t[o]=(...e)=>{let n=r.apply(t,e);return!1===n&&(n=s.apply(t,e)),n}}n.tokenizer=t}if(e.hooks){const t=this.defaults.hooks||new Ce;for(const n in e.hooks){const r=e.hooks[n],o=n,s=t[o];Ce.passThroughHooks.has(n)?t[o]=e=>{if(this.defaults.async)return Promise.resolve(r.call(t,e)).then(e=>s.call(t,e));const n=r.call(t,e);return s.call(t,n)}:t[o]=(...e)=>{let n=r.apply(t,e);return!1===n&&(n=s.apply(t,e)),n}}n.hooks=t}if(e.walkTokens){const t=this.defaults.walkTokens,r=e.walkTokens;n.walkTokens=function(e){let n=[];return n.push(r.call(this,e)),t&&(n=n.concat(t.call(this,e))),n}}this.defaults={...this.defaults,...n}}),this}setOptions(e){return this.defaults={...this.defaults,...e},this}lexer(e,t){return ve.lex(e,t??this.defaults)}parser(e,t){return Ee.parse(e,t??this.defaults)}#e(e,t){return(n,r)=>{const o={...r},s={...this.defaults,...o};!0===this.defaults.async&&!1===o.async&&(s.silent||console.warn("marked(): The async option was set to true by an extension. The async: false option sent to parse will be ignored."),s.async=!0);const a=this.#t(!!s.silent,!!s.async);if(null==n)return a(new Error("marked(): input parameter is undefined or null"));if("string"!=typeof n)return a(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(n)+", string expected"));if(s.hooks&&(s.hooks.options=s),s.async)return Promise.resolve(s.hooks?s.hooks.preprocess(n):n).then(t=>e(t,s)).then(e=>s.walkTokens?Promise.all(this.walkTokens(e,s.walkTokens)).then(()=>e):e).then(e=>t(e,s)).then(e=>s.hooks?s.hooks.postprocess(e):e).catch(a);try{s.hooks&&(n=s.hooks.preprocess(n));const r=e(n,s);s.walkTokens&&this.walkTokens(r,s.walkTokens);let o=t(r,s);return s.hooks&&(o=s.hooks.postprocess(o)),o}catch(e){return a(e)}}}#t(e,t){return n=>{if(n.message+="\nPlease report this to https://github.com/markedjs/marked.",e){const e="<p>An error occurred:</p><pre>"+ie(n.message+"",!0)+"</pre>";return t?Promise.resolve(e):e}if(t)return Promise.reject(n);throw n}}};function Te(e,t){return Se.parse(e,t)}function _e(e){return _e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_e(e)}function Ie(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Ae(r.key),r)}}function Ae(e){var t=function(e){if("object"!=_e(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=_e(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==_e(t)?t:t+""}Te.options=Te.setOptions=function(e){return Se.setOptions(e),Te.defaults=Se.defaults,ee(Te.defaults),Te},Te.getDefaults=function(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}},Te.defaults=J,Te.use=function(...e){return Se.use(...e),Te.defaults=Se.defaults,ee(Te.defaults),Te},Te.walkTokens=function(e,t){return Se.walkTokens(e,t)},Te.parseInline=Se.parseInline,Te.Parser=Ee,Te.parser=Ee.parse,Te.Renderer=we,Te.TextRenderer=xe,Te.Lexer=ve,Te.lexer=ve.lex,Te.Tokenizer=ye,Te.Hooks=Ce,Te.parse=Te,Te.options,Te.setOptions,Te.use,Te.walkTokens,Te.parseInline,Ee.parse,ve.lex;var Re,Oe,Ne,Me=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.setupMarkdown(),this.onSendMessageCallback=null,this.onClearConversationCallback=null,this.onDataSourceToggleCallback=null},t=[{key:"setupMarkdown",value:function(){Te.setOptions({breaks:!0,gfm:!0,sanitize:!1})}},{key:"setupEventListeners",value:function(){var e=this,t=document.getElementById("user-input"),n=document.getElementById("send-btn");n&&this.onSendMessageCallback&&n.addEventListener("click",this.onSendMessageCallback),t&&this.onSendMessageCallback&&(t.addEventListener("keypress",function(t){"Enter"!==t.key||t.shiftKey||(t.preventDefault(),e.onSendMessageCallback())}),t.focus()),this.addClearConversationButton(),this.setupDataSourceToggle()}},{key:"setOnSendMessageCallback",value:function(e){this.onSendMessageCallback=e}},{key:"setOnClearConversationCallback",value:function(e){this.onClearConversationCallback=e}},{key:"setOnDataSourceToggleCallback",value:function(e){this.onDataSourceToggleCallback=e}},{key:"addClearConversationButton",value:function(){var e=document.querySelector(".chat-input-container");if(e){var t=document.createElement("button");t.innerHTML="New Conversation",t.className="clear-btn",t.style.cssText="\n            width: 100%;\n            padding: 8px;\n            margin-top: 8px;\n            background: #404040;\n            color: #ffffff;\n            border: 1px solid #606060;\n            border-radius: 4px;\n            cursor: pointer;\n            font-size: 12px;\n            transition: background-color 0.2s;\n        ",t.addEventListener("mouseover",function(){t.style.backgroundColor="#ff6b35"}),t.addEventListener("mouseout",function(){t.style.backgroundColor="#404040"}),this.onClearConversationCallback&&t.addEventListener("click",this.onClearConversationCallback),e.appendChild(t)}}},{key:"setupDataSourceToggle",value:function(){var e=document.getElementById("use-selection");e&&this.onDataSourceToggleCallback&&e.addEventListener("change",this.onDataSourceToggleCallback)}},{key:"showWelcomeMessage",value:function(){var e=document.getElementById("chat-messages");e&&(e.innerHTML='\n            <div class="welcome-message">\n                <h3>Excel Data Assistant</h3>\n                <p>Ask questions about your Excel data and get intelligent analysis.</p>\n                \n                <div style="text-align: left; max-width: 300px; margin: 20px auto;">\n                    <h4 style="color: #ff8c42; font-size: 14px; margin: 15px 0 10px 0; font-weight: 600;">Example Questions:</h4>\n                    <ul style="font-size: 13px; line-height: 1.6; margin: 0; padding-left: 18px; color: #ccc;">\n                        <li>"What\'s the total revenue for Q4?"</li>\n                        <li>"Show me the trend in expenses"</li>\n                        <li>"Compare this year vs last year"</li>\n                        <li>"What are the key metrics in this sheet?"</li>\n                    </ul>\n                </div>\n            </div>\n        ')}},{key:"addChatMessage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=document.getElementById("chat-messages");if(o){var s=(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),a=document.createElement("div");a.className="message ".concat(t?"user":"assistant");var i=document.createElement("div");if(i.className="message-bubble ".concat(n?"error-message":""),t||n)i.textContent=e;else try{i.innerHTML=Te.parse(e)}catch(t){console.warn("Markdown parsing failed, falling back to plain text:",t),i.textContent=e}var l=document.createElement("div");if(l.className="message-time",l.textContent=s,!t&&!n&&r>1){var c=document.createElement("div");c.style.cssText="\n                font-size: 10px;\n                color: #999;\n                margin-top: 4px;\n                opacity: 0.7;\n            ",c.textContent="Context: ".concat(r," exchanges"),l.appendChild(c)}a.appendChild(i),a.appendChild(l),o.appendChild(a),o.scrollTop=o.scrollHeight}}},{key:"updateStatus",value:function(e){var t=document.getElementById("status-text");t&&(t.textContent=e)}},{key:"showLoading",value:function(e){var t=document.getElementById("loading-overlay");t&&(t.style.display=e?"flex":"none")}},{key:"setControlsEnabled",value:function(e){var t=document.getElementById("user-input"),n=document.getElementById("send-btn");t&&(t.disabled=!e),n&&(n.disabled=!e)}},{key:"showError",value:function(e){var t=e;e.includes("API key")?t+="\n\n**Troubleshooting:** Please ensure your Gemini API key is configured in your .env file.":e.includes("quota")?t+="\n\n**Troubleshooting:** API quota exceeded. Please try again later or check your billing settings.":e.includes("Excel data")&&(t+="\n\n**Troubleshooting:** Try selecting a data range first, or ensure your worksheet contains data."),this.addChatMessage(t,!1,!0),this.updateStatus("Error occurred - see message for details")}},{key:"getUserInput",value:function(){var e=document.getElementById("user-input");return e?e.value.trim():""}},{key:"clearUserInput",value:function(){var e=document.getElementById("user-input");e&&(e.value="")}},{key:"focusUserInput",value:function(){var e=document.getElementById("user-input");e&&e.focus()}},{key:"clearChatMessages",value:function(){var e=document.getElementById("chat-messages");e&&(e.innerHTML="")}},{key:"getUseSelectionState",value:function(){var e=document.getElementById("use-selection");return!e||e.checked}},{key:"handleDataSourceToggle",value:function(){this.getUseSelectionState()?this.updateStatus("Using selected range (or auto-detect if no selection)"):this.updateStatus("Using full sheet with intelligent sampling")}}],t&&Ie(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function De(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function s(n,r,o,s){var l=r&&r.prototype instanceof i?r:i,c=Object.create(l.prototype);return Le(c,"_invoke",function(n,r,o){var s,i,l,c=0,u=o||[],h=!1,d={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return s=t,i=0,l=e,d.n=n,a}};function p(n,r){for(i=n,l=r,t=0;!h&&c&&!o&&t<u.length;t++){var o,s=u[t],p=d.p,f=s[2];n>3?(o=f===r)&&(l=s[(i=s[4])?5:(i=3,3)],s[4]=s[5]=e):s[0]<=p&&((o=n<2&&p<s[1])?(i=0,d.v=r,d.n=s[1]):p<f&&(o=n<3||s[0]>r||r>f)&&(s[4]=n,s[5]=r,d.n=f,i=0))}if(o||n>1)return a;throw h=!0,r}return function(o,u,f){if(c>1)throw TypeError("Generator is already running");for(h&&1===u&&p(u,f),i=u,l=f;(t=i<2?e:l)||!h;){s||(i?i<3?(i>1&&(d.n=-1),p(i,l)):d.n=l:d.v=l);try{if(c=2,s){if(i||(o="next"),t=s[o]){if(!(t=t.call(s,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,i<2&&(i=0)}else 1===i&&(t=s.return)&&t.call(s),i<2&&(l=TypeError("The iterator does not provide a '"+o+"' method"),i=1);s=e}else if((t=(h=d.n<0)?l:n.call(r,d))!==a)break}catch(t){s=e,i=1,l=t}finally{c=1}}return{value:t,done:h}}}(n,o,s),!0),c}var a={};function i(){}function l(){}function c(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(Le(t={},r,function(){return this}),t),h=c.prototype=i.prototype=Object.create(u);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,Le(e,o,"GeneratorFunction")),e.prototype=Object.create(h),e}return l.prototype=c,Le(h,"constructor",c),Le(c,"constructor",l),l.displayName="GeneratorFunction",Le(c,o,"GeneratorFunction"),Le(h),Le(h,o,"Generator"),Le(h,r,function(){return this}),Le(h,"toString",function(){return"[object Generator]"}),(De=function(){return{w:s,m:d}})()}function Le(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}Le=function(e,t,n,r){function s(t,n){Le(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(s("next",0),s("throw",1),s("return",2))},Le(e,t,n,r)}function Pe(e,t,n,r,o,s,a){try{var i=e[s](a),l=i.value}catch(e){return void n(e)}i.done?t(l):Promise.resolve(l).then(r,o)}function $e(){return je.apply(this,arguments)}function je(){var e;return e=De().m(function e(){var t,n,r,o,s,a,i,l,c,u,h,d,p;return De().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t=Ne.getUserInput()){e.n=1;break}return e.a(2);case 1:return Ne.clearUserInput(),Ne.setControlsEnabled(!1),Ne.addChatMessage(t,!0),Oe.addToConversationHistory("user",t),Ne.showLoading(!0),Ne.updateStatus("Reading Excel data..."),e.p=2,i=Ne.getUseSelectionState(),e.n=3,Re.readCurrentWorksheetDataEnhanced(i);case 3:return l=e.v,Ne.updateStatus("Analyzing data..."),e.n=4,Oe.askGeminiWithContext(t,l);case 4:c=e.v,Oe.addToConversationHistory("assistant",c),u={isSampled:l.isSampled||!1,hasFormulas:(null===(n=l.structuredData)||void 0===n||null===(n=n.formulaAnalysis)||void 0===n?void 0:n.hasFormulas)||!1,multiSheet:(null===(r=l.workbookData)||void 0===r?void 0:r.totalSheets)>1||!1,hasObjects:(null===(o=l.dataMetadata)||void 0===o||null===(o=o.tables)||void 0===o?void 0:o.length)>0||(null===(s=l.dataMetadata)||void 0===s||null===(s=s.pivotTables)||void 0===s?void 0:s.length)>0||(null===(a=l.dataMetadata)||void 0===a||null===(a=a.charts)||void 0===a?void 0:a.length)>0||!1},h=Oe.getConversationLength(),Ne.addChatMessage(c,!1,!1,h,u),d="Analysis complete (".concat(h," exchanges)"),u.isSampled&&(d+=" • Sampled"),d+=" • Ready",Ne.updateStatus(d),e.n=6;break;case 5:e.p=5,p=e.v,console.error("Error processing message:",p),Ne.addChatMessage("Sorry, I encountered an error processing your request. Please try again.",!1,!0),Ne.updateStatus("Error occurred - please try again");case 6:return e.p=6,Ne.showLoading(!1),Ne.setControlsEnabled(!0),Ne.focusUserInput(),e.f(6);case 7:return e.a(2)}},e,null,[[2,5,6,7]])}),je=function(){var t=this,n=arguments;return new Promise(function(r,o){var s=e.apply(t,n);function a(e){Pe(s,r,o,a,i,"next",e)}function i(e){Pe(s,r,o,a,i,"throw",e)}a(void 0)})},je.apply(this,arguments)}function Fe(){Oe.clearConversation(),Ne.clearChatMessages(),Ne.showWelcomeMessage(),Ne.updateStatus("Conversation cleared - ready for new questions"),Re.clearCurrentData(),console.log("Conversation and enhanced data cache cleared")}"undefined"!=typeof window&&(window.UIService=Me),Office.onReady(function(e){e.host===Office.HostType.Excel&&(function(){try{Re=new window.DataService,Oe=new window.AIService,Ne=new window.UIService,Oe.initializeGemini(),Ne.setOnSendMessageCallback($e),Ne.setOnClearConversationCallback(Fe),Ne.setOnDataSourceToggleCallback(function(){return Ne.handleDataSourceToggle()}),Ne.setupEventListeners(),Ne.showWelcomeMessage(),Ne.updateStatus("Ready to analyze your data")}catch(e){console.error("Error initializing services:",e),Ne&&Ne.showError("Failed to initialize application: "+e.message)}}(),console.log("Enhanced Excel Chatbot initialized successfully"))})}(),function(){"use strict";new URL(n(58394),n.b),new URL(n(98362),n.b),new URL(n(60947),n.b)}()}();
//# sourceMappingURL=taskpane.js.map