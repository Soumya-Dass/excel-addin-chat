/*! For license information please see 60cb60db06076b674850.js.LICENSE.txt */
function _regenerator(){var e,r,t="function"==typeof Symbol?Symbol:{},n=t.iterator||"@@iterator",a=t.toStringTag||"@@toStringTag";function i(t,n,a,i){var s=n&&n.prototype instanceof c?n:c,u=Object.create(s.prototype);return _regeneratorDefine2(u,"_invoke",function(t,n,a){var i,c,s,u=0,l=a||[],v=!1,d={p:0,n:0,v:e,a:S,f:S.bind(e,4),d:function(r,t){return i=r,c=0,s=e,d.n=t,o}};function S(t,n){for(c=t,s=n,r=0;!v&&u&&!a&&r<l.length;r++){var a,i=l[r],S=d.p,f=i[2];t>3?(a=f===n)&&(s=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=e):i[0]<=S&&((a=t<2&&S<i[1])?(c=0,d.v=n,d.n=i[1]):S<f&&(a=t<3||i[0]>n||n>f)&&(i[4]=t,i[5]=n,d.n=f,c=0))}if(a||t>1)return o;throw v=!0,n}return function(a,l,f){if(u>1)throw TypeError("Generator is already running");for(v&&1===l&&S(l,f),c=l,s=f;(r=c<2?e:s)||!v;){i||(c?c<3?(c>1&&(d.n=-1),S(c,s)):d.n=s:d.v=s);try{if(u=2,i){if(c||(a="next"),r=i[a]){if(!(r=r.call(i,s)))throw TypeError("iterator result is not an object");if(!r.done)return r;s=r.value,c<2&&(c=0)}else 1===c&&(r=i.return)&&r.call(i),c<2&&(s=TypeError("The iterator does not provide a '"+a+"' method"),c=1);i=e}else if((r=(v=d.n<0)?s:t.call(n,d))!==o)break}catch(r){i=e,c=1,s=r}finally{u=1}}return{value:r,done:v}}}(t,a,i),!0),u}var o={};function c(){}function s(){}function u(){}r=Object.getPrototypeOf;var l=[][n]?r(r([][n]())):(_regeneratorDefine2(r={},n,function(){return this}),r),v=u.prototype=c.prototype=Object.create(l);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,_regeneratorDefine2(e,a,"GeneratorFunction")),e.prototype=Object.create(v),e}return s.prototype=u,_regeneratorDefine2(v,"constructor",u),_regeneratorDefine2(u,"constructor",s),s.displayName="GeneratorFunction",_regeneratorDefine2(u,a,"GeneratorFunction"),_regeneratorDefine2(v),_regeneratorDefine2(v,a,"Generator"),_regeneratorDefine2(v,n,function(){return this}),_regeneratorDefine2(v,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:i,m:d}})()}function _regeneratorDefine2(e,r,t,n){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}_regeneratorDefine2=function(e,r,t,n){function i(r,t){_regeneratorDefine2(e,r,function(e){return this._invoke(r,t,e)})}r?a?a(e,r,{value:t,enumerable:!n,configurable:!n,writable:!n}):e[r]=t:(i("next",0),i("throw",1),i("return",2))},_regeneratorDefine2(e,r,t,n)}function asyncGeneratorStep(e,r,t,n,a,i,o){try{var c=e[i](o),s=c.value}catch(e){return void t(e)}c.done?r(s):Promise.resolve(s).then(n,a)}function _asyncToGenerator(e){return function(){var r=this,t=arguments;return new Promise(function(n,a){var i=e.apply(r,t);function o(e){asyncGeneratorStep(i,n,a,o,c,"next",e)}function c(e){asyncGeneratorStep(i,n,a,o,c,"throw",e)}o(void 0)})}}import"./dataService.js";import"./aiService.js";import"./uiService.js";var dataService,aiService,uiService;function initializeServices(){try{dataService=new window.DataService,aiService=new window.AIService,uiService=new window.UIService,aiService.initializeGemini(),uiService.setOnSendMessageCallback(handleSendMessage),uiService.setOnClearConversationCallback(handleClearConversation),uiService.setOnDataSourceToggleCallback(function(){return uiService.handleDataSourceToggle()}),uiService.setupEventListeners(),uiService.showWelcomeMessage(),uiService.updateStatus("Ready to analyze your data")}catch(e){console.error("Error initializing services:",e),uiService&&uiService.showError("Failed to initialize application: "+e.message)}}function handleSendMessage(){return _handleSendMessage.apply(this,arguments)}function _handleSendMessage(){return(_handleSendMessage=_asyncToGenerator(_regenerator().m(function e(){var r,t,n,a,i,o,c,s,u,l,v,d,S;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:if(r=uiService.getUserInput()){e.n=1;break}return e.a(2);case 1:return uiService.clearUserInput(),uiService.setControlsEnabled(!1),uiService.addChatMessage(r,!0),aiService.addToConversationHistory("user",r),uiService.showLoading(!0),uiService.updateStatus("Reading Excel data..."),e.p=2,c=uiService.getUseSelectionState(),e.n=3,dataService.readCurrentWorksheetDataEnhanced(c);case 3:return s=e.v,uiService.updateStatus("Analyzing data..."),e.n=4,aiService.askGeminiWithContext(r,s);case 4:u=e.v,aiService.addToConversationHistory("assistant",u),l={isSampled:s.isSampled||!1,hasFormulas:(null===(t=s.structuredData)||void 0===t||null===(t=t.formulaAnalysis)||void 0===t?void 0:t.hasFormulas)||!1,multiSheet:(null===(n=s.workbookData)||void 0===n?void 0:n.totalSheets)>1||!1,hasObjects:(null===(a=s.dataMetadata)||void 0===a||null===(a=a.tables)||void 0===a?void 0:a.length)>0||(null===(i=s.dataMetadata)||void 0===i||null===(i=i.pivotTables)||void 0===i?void 0:i.length)>0||(null===(o=s.dataMetadata)||void 0===o||null===(o=o.charts)||void 0===o?void 0:o.length)>0||!1},v=aiService.getConversationLength(),uiService.addChatMessage(u,!1,!1,v,l),d="Analysis complete (".concat(v," exchanges)"),l.isSampled&&(d+=" • Sampled"),d+=" • Ready",uiService.updateStatus(d),e.n=6;break;case 5:e.p=5,S=e.v,console.error("Error processing message:",S),uiService.addChatMessage("Sorry, I encountered an error processing your request. Please try again.",!1,!0),uiService.updateStatus("Error occurred - please try again");case 6:return e.p=6,uiService.showLoading(!1),uiService.setControlsEnabled(!0),uiService.focusUserInput(),e.f(6);case 7:return e.a(2)}},e,null,[[2,5,6,7]])}))).apply(this,arguments)}function handleClearConversation(){aiService.clearConversation(),uiService.clearChatMessages(),uiService.showWelcomeMessage(),uiService.updateStatus("Conversation cleared - ready for new questions"),dataService.clearCurrentData(),console.log("Conversation and enhanced data cache cleared")}Office.onReady(function(e){e.host===Office.HostType.Excel&&(initializeServices(),console.log("Enhanced Excel Chatbot initialized successfully"))});